{"version":3,"sources":["components/form/CircleBtn.tsx","components/form/FileInput.tsx","components/form/Toast.tsx","utils/storage.ts","utils/states.ts","utils/timestamp.ts","utils/caption.ts","pages/Intro.tsx","components/video/CaptionEditor.tsx","components/video/CaptionView.tsx","components/video/SimpleTimeline.tsx","components/video/VideoPlayer.tsx","components/video/SubtitleTimeLine.tsx","utils/consts.ts","pages/Studio.tsx","components/video/TimeControll.tsx","assets/TimeControll.jpg","assets/stickTime.png","pages/Help.tsx","App.tsx","index.tsx"],"names":["CircleBtn","className","this","props","disabled","onClick","iconClassName","text","React","Component","FileInput","state","fileInput","filename","createRef","changeHandler","bind","redirectToInput","e","inputFileElem","target","onChange","files","length","file","setState","name","current","click","placeHolder","type","ref","pushToast","t","ev","CustomEvent","detail","window","dispatchEvent","Toast","isOpen","timerId","lastMessage","kind","message","duration","disableToast","cancelToast","cancelTimer","clearTimeout","console","log","timeout","setTimeout","addEventListener","removeEventListener","s","WindowStates","given_data","data","new_val","obj","videoUrl","subtitles","digitalClock","num","numberOfZeroes","i","tens","Math","pow","repeat","String","second2timestamp","total_seconds","mode","miliseconds","floor","seconds","minutes","hours","timestamp2seconds","timestamp","Number","slice","captionsCompare","a","b","start","Intro","subtitleUrl","canPass","handler","loadCaptions","checkValidation","fetch","response","appStates","setData","content","Array","from","matchAll","map","m","end","trim","hash","uuid","f","fileType","blob","URL","createObjectURL","to","href","CaptionEditor","inputRef","lastCaption","newCaption","is_ltr","onCaptionContentChanged","onCaptionTimeRangeChanged","handleCaptionChange","isCapInTimeRange","hotkeys","kv","preventDefault","caption","newPropCap","time","totalTime","newCap","value","startChange","endChange","cap","currentTime","onCaptionChanged","focus","blur","changeValue","ls","onBlur","CaptionView","getCaptionContent","captions","find","c","SimpleTimeline","handleClick","onSelectNewTime","element","currentTarget","pageX","offsetLeft","clientWidth","undefined","widthPercent","style","width","VideoPlayer","videoElementRef","timer","lastStart","showVideoControll","onTimeUpdate","onMouseMove","onError","setPlay","isPlaying","disableVideoControllers","onDurationChanges","du","videoControllHiddingDelay","timePerSeconds","ve","setTime","play","pause","Boolean","paused","onMouseOut","onContextMenu","src","autoPlay","loop","onDurationChange","SubtitleTimeline","canvasRef","error","lastScale","scale","captionSelectionHandler","drawTimeRuler","setTimeFromPixels","zoom","zoomIn","zoomOut","isZoomInValid","isZoomOutValid","index","onCaptionSelected","val","timePerPixels","ctx","getContext","second","fillText","fillRect","currentScale","percent","marginLeft","transform","height","onTimePick","selected_i","clickFunc","left","captionItem","selectedCaption_i","ActionTypes","UserCursorElem","cursorXPos","getBoundingClientRect","calculateRealOffset","onMouseLeave","TimeControll","isEditing","timeEditing","changeTimeEditing","textEditorTimeChange","newTime","newTimeString","delataTime","changeEditingState","changedValue","timeElem","autoFocus","onDoubleClick","fileDownload","require","Studio","VideoPlayerRef","getData","selected_caption_i","historyCursor","capsHistory","onVideoError","addCaptionUIHandler","addCaptionObject","changeCaptionUIHandler","changeCaptionObject","deleteCaptionUIHandler","deleteCaptionObject","captionSelectionToggle","updateHistoryCursor","undoRedo","saveFile","initCaps","filter","shootTime","findIndex","tagName","togglePlay","unbind","nt","sci","isplying","Create","changes","fromCap","toCap","oldCap","Change","selected_caption_index","_","Delete","hc","lastHistory","splice","undo","newState","redo","history","caps","lastAction","sort","join","selected_ci","Help","shortcuts","keys","clue","id","TCtrolImg","alt","StickTimeImg","sh","k","App","basename","exact","path","component","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.c100aec0.chunk.js","sourcesContent":["import React, { MouseEvent } from 'react'\n\nimport './circle-btn.sass'\n\ntype Props = {\n  text?: string\n  className?: string\n  iconClassName: string\n  disabled?: boolean\n  onClick: (me: MouseEvent) => void\n}\n\nexport default class CircleBtn extends React.Component<Props> {\n\n  render() {\n    return (<>\n      <div className={\"d-inline-block \" + this.props.className}>\n        <button className={\"btn circle-btn add-caption-btn \" + (this.props.disabled ? 'disabled' : '')}\n          onClick={this.props.onClick}>\n          <span className={this.props.iconClassName}></span>\n        </button>\n\n        {this.props.text ? (\n          <div className=\"badge\">\n            <span> {this.props.text} </span>\n          </div>\n        ) : ''}\n      </div>\n    </>)\n  }\n}\n\n","import React, { ChangeEvent, createRef, RefObject } from 'react'\nimport './file-input.sass'\n\ntype Props = {\n\tonChange?: (f: File) => void\n}\n\nclass FileInput extends React.Component<Props> {\n\tstate: { filename: string }\n\tfileInput: RefObject<HTMLInputElement>\n\n\tconstructor(props: any) {\n\t\tsuper(props)\n\t\tthis.state = { filename: '' }\n\n\t\tthis.fileInput = createRef()\n\n\t\tthis.changeHandler = this.changeHandler.bind(this)\n\t\tthis.redirectToInput = this.redirectToInput.bind(this)\n\t}\n\n\tchangeHandler(e: ChangeEvent<HTMLInputElement>) {\n\t\tconst inputFileElem = e.target\n\n\t\t// send selected file to it\n\t\tif (this.props.onChange && inputFileElem.files?.length) {\n\t\t\tconst file = inputFileElem.files[0]\n\t\t\tthis.props.onChange(file)\n\n\t\t\tthis.setState({ filename: file.name })\n\t\t}\n\t}\n\n\tredirectToInput() {\n\t\tthis.fileInput.current?.click()\n\t}\n\n\trender() {\n\t\tconst\n\t\t\tfilename = this.state.filename,\n\t\t\tplaceHolder = filename ? `[${filename}] click to rechoose` : 'choose a file'\n\n\t\treturn (\n\t\t\t<div className=\"form-group file-input-wrapper\">\n\t\t\t\t<input type=\"file\" ref={this.fileInput} className=\"d-none\"\n\t\t\t\t\tonChange={this.changeHandler} />\n\n\t\t\t\t<button\n\t\t\t\t\tclassName=\"rounded font-weight-bold btn btn-info w-100 virtual-file-input\"\n\t\t\t\t\tonClick={e => this.redirectToInput()}>\n\t\t\t\t\t<span> {placeHolder} </span>\n\t\t\t\t</button>\n\n\t\t\t</div>\n\t\t)\n\t}\n}\n\nexport default FileInput","import React from 'react'\n\nexport type ToastData = {\n  kind: \"danger\" | \"warning\" | \"success\"\n  message: string,\n  duration: number\n}\n\nexport function pushToast(t: ToastData) {\n  const ev = new CustomEvent('toast', { detail: t })\n  window.dispatchEvent(ev)\n}\n\ntype State = {\n  isOpen: boolean,\n  timerId: number,\n\n  lastMessage: ToastData\n}\nexport default class Toast extends React.Component<{}, State> {\n  constructor(props: any) {\n    super(props)\n\n    this.state = {\n      isOpen: false,\n      timerId: 0,\n      lastMessage: { kind: \"success\", message: \"\", duration: 0 }\n    }\n\n    this.disableToast = this.disableToast.bind(this)\n    this.cancelToast = this.cancelToast.bind(this)\n    this.cancelTimer = this.cancelTimer.bind(this)\n  }\n\n  // --------------- functionalities ----------------\n  cancelTimer() {\n    if (this.state.timerId) {\n      clearTimeout(this.state.timerId)\n      this.setState({ timerId: 0 })\n    }\n  }\n\n  cancelToast() {\n    this.cancelTimer()\n    console.log(\"errrrr\");\n    this.setState({ isOpen: false })\n  }\n\n  disableToast(timeout: number) {\n    this.cancelTimer()\n\n    this.setState({\n      timerId: window.setTimeout(this.cancelToast, timeout)\n    })\n  }\n\n  // ------------------ component API ----------------------\n\n  componentDidMount() {\n    // @ts-ignore\n    window.addEventListener('toast', (ev: CustomEvent<ToastData>) => {\n      this.setState({ lastMessage: ev.detail, isOpen: true })\n      this.disableToast(ev.detail.duration)\n    })\n  }\n\n  componentWillUnmount() {\n    // @ts-ignore\n    window.removeEventListener('toast')\n  }\n\n  render() {\n    const s = this.state\n    return (<>\n      <div className={\"fixed-bottom m-4 alert \" +\n        `alert-${s.lastMessage.kind} ${s.isOpen ? \"\" : \"d-none\"}`}>\n        <button className=\"close\" onClick={this.cancelToast}>&times;</button>\n        <strong>{s.lastMessage.message}</strong>\n      </div>\n    </>)\n  }\n}\n\n","export class WindowStates<T> { // global state: just a data wrapper\n  data: T\n  constructor(given_data: T) {\n    this.data = given_data\n  }\n\n  getData(): T {\n    return this.data\n  }\n\n  setData(new_val: T) {\n    this.data = new_val\n  }\n}","import { WindowStates } from \"./storage\"\nimport { Caption } from \"./caption\"\n\nconst obj = {\n  videoUrl: new WindowStates<string>(''),\n  subtitles: new WindowStates<Caption[]>([])\n}\n\nexport default obj","function digitalClock(num: number, numberOfZeroes: number = 2): string {\n    let i = 1\n    while (i <= numberOfZeroes) {\n        const tens = Math.pow(10, i)\n\n        if (num >= tens) i++\n        else break\n    }\n\n    return '0'.repeat(numberOfZeroes - i) + String(num)\n}\n\n// FIXME: minutes are diffrent in diffrent modes\nfunction second2timestamp(total_seconds: number, mode: 'minute' | 'minute+ms' | 'complete'): string {\n    const miliseconds = Math.floor((total_seconds % 1) * 1000),\n        seconds = Math.floor(total_seconds % 60),\n        minutes = Math.floor((total_seconds % 3600) / 60),\n        hours = Math.floor(total_seconds / 3600)\n\n    if (mode === 'minute')\n        return `${digitalClock(minutes)}:${digitalClock(seconds)}`\n    else if (mode === \"minute+ms\")\n        return `${digitalClock(minutes)}:${digitalClock(seconds)}.${digitalClock(miliseconds, 3)}`\n    else if (mode === 'complete')\n        return `${digitalClock(hours)}:${digitalClock(minutes)}:${digitalClock(seconds)},${digitalClock(miliseconds, 3)}`\n    else\n        return ''\n}\n\n// for example: timestamp = 00:00:00:654\nfunction timestamp2seconds(timestamp: string): number {\n    const hours = Number(timestamp.slice(0, 2)),\n        minutes = Number(timestamp.slice(3, 5)),\n        seconds = Number(timestamp.slice(6, 8)),\n        miliseconds = Number(timestamp.slice(9))\n\n    return (hours * 60 * 60) + (minutes * 60) + (seconds) + (miliseconds / 1000)\n}\n\n\nexport { timestamp2seconds, second2timestamp, digitalClock, }","import { second2timestamp, timestamp2seconds } from \"./timestamp\"\nimport { v4 as uuid } from \"uuid\"\n\nexport type Caption = {\n  start: number\n  end: number\n  content: string\n  hash: string // for rendering\n}\n\nexport function captionsCompare(a: Caption, b: Caption): number {\n  if (a.start > b.start) return 1\n  else if (b.start > a.start) return -1\n  else return 0\n}\n\nexport function areSameCaptions(a: Caption, b: Caption): boolean {\n  return (a.start === b.start) && (a.end === b.end) && (a.content === b.content)\n}\n\n// save as .srt format\nexport function export2srt(caps: Caption[]): string {\n  return caps.map((c, i) =>\n    `${i + 1}\\n${second2timestamp(c.start, \"complete\")} --> ${second2timestamp(c.end, \"complete\")}\\n${c.content}`)\n    .join('\\n\\n')\n}\n\nexport function parseSrt(content: string): Caption[] {\n  const matches = Array.from(content.matchAll(\n    /\\d+\\n([\\d,:]{12}) --> ([\\d,:]{12})\\n(.+?)(?=\\d+\\n[\\d,:]{12}|$)/gs))\n\n  return matches.map(m => ({\n    start: timestamp2seconds(m[1]),\n    end: timestamp2seconds(m[2]),\n    content: m[3].trim(),\n    hash: uuid()\n  }))\n}","import React from 'react'\nimport { Link, Redirect } from \"react-router-dom\"\n\nimport { FileInput, pushToast } from \"../components/form\"\nimport appStates from \"../utils/states\"\nimport { parseSrt } from \"../utils/caption\"\n\nimport \"./intro.sass\"\n\ntype State = {\n  subtitleUrl: string\n  videoUrl: string\n  canPass: boolean\n}\nexport default class Intro extends React.Component<{}, State> {\n  constructor(props: any) {\n    super(props)\n    this.state = {\n      subtitleUrl: '',\n      videoUrl: '',\n      canPass: false,\n    }\n\n    this.handler = this.handler.bind(this)\n    this.loadCaptions = this.loadCaptions.bind(this)\n    this.checkValidation = this.checkValidation.bind(this)\n  }\n\n  async loadCaptions() {\n    if (this.state.subtitleUrl === '')\n      return\n\n    const response = await fetch(this.state.subtitleUrl),\n      data = await response.text()\n\n    appStates.subtitles.setData(parseSrt(data))\n  }\n\n  handler(f: File, fileType: \"video\" | \"subtitle\") {\n    const blob = URL.createObjectURL(f)\n\n    if (fileType === 'video') {\n      appStates.videoUrl.setData(blob)\n      this.setState({ videoUrl: blob }, this.loadCaptions)\n    }\n    else\n      this.setState({ subtitleUrl: blob }, this.loadCaptions)\n  }\n\n  checkValidation() {\n    if (this.state.videoUrl)\n      this.setState({ canPass: true })\n\n    else\n      pushToast({\n        kind: 'danger', \n        message: \"select a video first\",\n         duration: 5000\n      })\n  }\n\n  render() {\n    if (this.state.canPass)\n      return <Redirect to=\"/studio\" />\n\n    return (<>\n      <h2 className=\"page-title\" >Intro</h2>\n      <div className=\"wrapper\">\n\n        <div className=\"alert alert-secondary\">\n          consider‌ <Link to=\"/help\">‌help page‌</Link> for learning app features & shortcuts\n        </div>\n        <div>\n          <span>video file:</span>\n          <FileInput onChange={f => this.handler(f, 'video')} />\n        </div>\n\n        <div className=\"alert alert-info\">\n          you can check supported video formats\n          <a href=\"https://en.wikipedia.org/wiki/HTML5_video\" target=\"blank\"> here </a>\n        </div>\n\n        <div className=\"mt-3\">\n          <span>subtitle file:</span>\n          <FileInput onChange={f => this.handler(f, 'subtitle')} />\n        </div>\n        <div className=\"alert alert-warning\">\n          if you don't select a subtitle file, we make new one\n        </div>\n\n        <div className=\"center\">\n          <button className=\"btn btn-success font-weight-bold\" onClick={this.checkValidation}>\n            go to studio!\n          </button>\n        </div>\n\n      </div>\n\n      <footer className=\"p-2 w-100 d-flex justify-content-center\">\n        <a href=\"https://github.com/hamidb80/subtitle-edtior/\" target=\"blank\"\n          className=\"d-flex align-items-center\">\n          <span className=\"fab fa-github github-logo\"></span>\n          <span className=\"pb-1 mx-2\"> project link on github </span>\n        </a>\n      </footer>\n    </>)\n  }\n}\n","import React, { ChangeEvent } from 'react'\nimport hotkeys from 'hotkeys-js'\n\nimport { TimeControll } from \".\"\nimport { CircleBtn } from \"../form\"\nimport { Caption, areSameCaptions } from \"../../utils/caption\"\nimport { v4 as uuid } from \"uuid\"\n\nimport { SHOOT_SUBTITLE_TIME_MAJOR } from \"../../utils/consts\"\n\nimport './caption-editor.sass'\n\n\ntype Props = {\n  currentTime: number // for stick time button\n  totalTime: number // video duration\n\n  caption: Caption | null\n  onCaptionChanged: (cOld: Caption, cNew: Caption) => void\n}\ntype State = {\n  lastCaption: Caption | null, // a copy of props.caption to edit\n  newCaption: Caption | null,\n\n  is_ltr: boolean\n}\nexport default class CaptionEditor extends React.Component<Props, State> {\n  inputRef: React.RefObject<HTMLInputElement>\n\n  constructor(props: any) {\n    super(props)\n\n    this.state = {\n      lastCaption: null,\n      newCaption: null,\n\n      is_ltr: true\n    }\n    this.inputRef = React.createRef()\n\n    // --- binding methods ---\n    this.onCaptionContentChanged = this.onCaptionContentChanged.bind(this)\n    this.onCaptionTimeRangeChanged = this.onCaptionTimeRangeChanged.bind(this)\n    this.handleCaptionChange = this.handleCaptionChange.bind(this)\n    this.isCapInTimeRange = this.isCapInTimeRange.bind(this)\n  }\n\n  // ------------------- component API -------------------------\n\n  componentDidMount() {\n    hotkeys('alt+left', () => {\n      this.onCaptionTimeRangeChanged(-SHOOT_SUBTITLE_TIME_MAJOR, 0)\n    })\n\n    hotkeys('ctrl+home', kv => {\n      kv.preventDefault()\n      this.onCaptionTimeRangeChanged(null, 0)\n    })\n    hotkeys('ctrl+end', kv => {\n      kv.preventDefault()\n      this.onCaptionTimeRangeChanged(0, null)\n    })\n\n    hotkeys('ctrl+[', kv => {\n      kv.preventDefault()\n      this.setState({is_ltr: true})\n    })\n    hotkeys('ctrl+]', kv => {\n      kv.preventDefault()\n      this.setState({is_ltr: false})\n    })\n\n    hotkeys('alt+right', () => {\n      this.onCaptionTimeRangeChanged(+SHOOT_SUBTITLE_TIME_MAJOR, 0)\n    })\n    hotkeys('tab+left', kv => {\n      kv.preventDefault()\n      this.onCaptionTimeRangeChanged(0, -SHOOT_SUBTITLE_TIME_MAJOR)\n    })\n    hotkeys('tab+right', kv => {\n      kv.preventDefault()\n      this.onCaptionTimeRangeChanged(0, +SHOOT_SUBTITLE_TIME_MAJOR)\n    })\n  }\n\n  componentDidUpdate() {\n    if (\n      (!this.props.caption && this.state.lastCaption) ||\n      (this.props.caption && (this.props.caption.hash !== this.state.lastCaption?.hash))\n    ) {\n      this.handleCaptionChange() // onblur is not triggered when you blur it by code, so this line solves the problem\n\n      const newPropCap = this.props.caption === null ? null : { ...this.props.caption }\n      this.setState({\n        lastCaption: newPropCap ? { ...newPropCap } : null,\n        newCaption: newPropCap ? { ...newPropCap } : null\n      })\n    }\n  }\n\n  // ------------------- functionalities -------------------------\n\n  isCapInTimeRange(time: number): boolean {\n    return time >= 0 && time <= this.props.totalTime\n  }\n\n  onCaptionContentChanged(e: ChangeEvent<HTMLInputElement>) {\n    const newCap = this.state.newCaption\n    if (newCap !== null)\n      this.setState({\n        newCaption: { ...newCap, content: e.target.value }\n      })\n  }\n  onCaptionTimeRangeChanged(startChange: number | null = 0, endChange: number | null = 0) { // null is the value for stick time button\n    const cap = this.state.newCaption\n    if (cap === null) return\n\n    // controll the caption start/end time \n    if (startChange === null)\n      cap.start = this.props.currentTime\n    else if (this.isCapInTimeRange(cap.start + startChange))\n      cap.start += startChange\n\n    if (endChange === null)\n      cap.end = this.props.currentTime\n    else if (this.isCapInTimeRange(cap.end + endChange))\n      cap.end += endChange\n\n    // sync end & start\n    if (cap.start > cap.end) {\n      if (endChange === 0)\n        cap.end = cap.start\n      else\n        cap.start = cap.end\n    }\n\n    this.setState(\n      { newCaption: cap },\n      this.handleCaptionChange)\n\n  }\n\n  handleCaptionChange() {\n    if (this.state.lastCaption === null || this.state.newCaption === null) return\n\n    if (!areSameCaptions(this.state.lastCaption, this.state.newCaption)) {\n      const\n        lastCaption = this.state.lastCaption,\n        newCap = { ...this.state.newCaption, hash: uuid() }\n\n      this.setState({\n        lastCaption: { ...newCap },\n        newCaption: { ...newCap }\n      }, () => this.props.onCaptionChanged(lastCaption, newCap))\n    }\n  }\n\n  render() {\n    const cap = this.props.caption // myabe it's not available [for eg it can be removed]\n    if (cap)\n      this.inputRef.current?.focus()\n    else\n      this.inputRef.current?.blur()\n\n    return (\n      <div className=\"caption-editor-wrapper\">\n        {cap ?\n          <TimeControll\n            time={cap.start}\n            onChange={changeValue => { this.onCaptionTimeRangeChanged(changeValue, 0) }}\n          /> :\n          <TimeControll time={0} />\n        }\n\n        <div>\n          <CircleBtn\n            disabled={cap === null}\n            onClick={() => this.setState(ls => ({is_ltr: !ls.is_ltr}))}\n            iconClassName={\"fas fa-align-\" + (this.state.is_ltr ? \"left\" : \"right\")}\n          />\n          <input type=\"text\" ref={this.inputRef} disabled={cap === null}\n            className={\"form-control caption-editor \" + (cap ? '' : 'invisible') +\n              (this.state.is_ltr ? \"ltr\" : \"rtl\")}\n            value={this.state.newCaption?.content || \"\"}\n            onChange={this.onCaptionContentChanged}\n            onBlur={this.handleCaptionChange} />\n        </div>\n\n        {cap ?\n          <TimeControll\n            time={cap.end}\n            onChange={changeValue => { this.onCaptionTimeRangeChanged(0, changeValue) }}\n          /> :\n          <TimeControll time={0} />\n        }\n      </div>\n    )\n  }\n}","import React from 'react'\nimport { Caption } from \"../../utils/caption\"\nimport './caption-view.sass'\n\ntype Props = {\n  currentTime: number\n  captions: Caption[]\n}\nexport default class CaptionView extends React.Component<Props> {\n  constructor(props: any) {\n    super(props)\n    \n    this.getCaptionContent = this.getCaptionContent.bind(this)\n  }\n\n  getCaptionContent(): string {\n    const\n      t = this.props.currentTime,\n      cap = this.props.captions.find((c: Caption) => t >= c.start && t <= c.end)\n\n    return cap ? cap.content : \"\"\n  }\n\n  render() {\n    const content = this.getCaptionContent()\n\n    return (\n      <div className=\"caption-group\">\n        {content === \"\" ? '' :\n          <div className=\"caption\">\n            {content}\n          </div>\n        }\n      </div>\n    )\n  }\n}\n\n","import React, { MouseEvent } from 'react'\nimport { second2timestamp } from \"../../utils/timestamp\"\n\nimport './simple-timeline.sass'\n\ntype Props = {\n  className?: string\n\n  totalTime: number // per seconds\n  currentTime: number\n  onSelectNewTime?: (newTime: number) => void\n}\nexport default class SimpleTimeline extends React.Component<Props> {\n  constructor(props: any) {\n    super(props)\n\n    this.handleClick = this.handleClick.bind(this)\n  }\n\n  handleClick(e: MouseEvent<HTMLDivElement>) {\n    const handler = this.props.onSelectNewTime\n\n    if (handler) {\n      const element = e.currentTarget\n        , xUserClicked = e.pageX\n        , xFirstOfProgressBar = element.offsetLeft\n        , width = element.clientWidth\n        , videoDuration = this.props.totalTime\n\n      const newTime = ((xUserClicked - xFirstOfProgressBar) / width) * videoDuration\n\n      handler(newTime)\n    }\n  }\n\n  render() {\n    if (this.props.totalTime === undefined)\n      return ''\n\n    const\n      widthPercent = this.props.currentTime / this.props.totalTime * 100,\n      time = second2timestamp(this.props.currentTime, \"minute\"),\n      duration = second2timestamp(this.props.totalTime, \"minute\")\n\n    return (\n      <div className={\"timeline \" + this.props.className}\n        onClick={this.handleClick}>\n        \n        <div className=\"progress\">\n          <div className=\"progress-bar\" style={{ width: `${widthPercent}%` }}></div>\n          <div className=\"cursor\"></div>\n        </div>\n\n        <div className=\"time-text-wrapper\">\n          <div className=\"time-text\">\n            <span> {time} </span>\n            <span> - </span>\n            <span> {duration} </span>\n          </div>\n        </div>\n\n      </div>\n    )\n  }\n}","import React, { SyntheticEvent, MouseEvent } from 'react'\n\nimport \"./video-player.sass\"\n\nconst videoControllHiddingDelay = 2\n\n\ntype Props = {\n  videoUrl: string\n  onTimeUpdate?: (timePerSecond: number) => void\n  onError?: (e: SyntheticEvent) => void\n  onDurationChanges: (duration: number) => void\n}\nexport default class VideoPlayer extends React.Component<Props> {\n  videoElementRef: React.RefObject<HTMLVideoElement>\n  timer: number = 0 // for settimeout\n\n  state: {\n    lastStart: number\n    showVideoControll: boolean\n  }\n\n  constructor(props: any) {\n    super(props)\n\n    this.state = {\n      lastStart: 0,\n      showVideoControll: false\n    }\n\n    this.videoElementRef = React.createRef()\n\n    // --- register methods ---\n    // events\n    this.onTimeUpdate = this.onTimeUpdate.bind(this)\n    this.onMouseMove = this.onMouseMove.bind(this)\n    this.onError = this.onError.bind(this)\n\n    // actions\n    this.setPlay = this.setPlay.bind(this)\n    this.isPlaying = this.isPlaying.bind(this)\n    this.disableVideoControllers = this.disableVideoControllers.bind(this)\n\n    this.onDurationChanges = this.onDurationChanges.bind(this)\n  }\n\n  // ----------------------- events ------------------------\n\n  onDurationChanges() {\n    // emit signal\n    if (this.props.onDurationChanges) {\n      const du = this.videoElementRef.current?.duration || 0\n      this.props.onDurationChanges(du)\n    }\n  }\n\n  onTimeUpdate(e: SyntheticEvent<HTMLVideoElement, Event>) {\n    if (this.props.onTimeUpdate) {\n      const currentTime = e.currentTarget.currentTime\n      this.props.onTimeUpdate(currentTime)\n    }\n  }\n\n  onMouseMove(e: MouseEvent) {\n    if (this.timer)\n      clearTimeout(this.timer)\n\n    this.setState({ showVideoControll: true })\n    this.timer = +setTimeout(this.disableVideoControllers, videoControllHiddingDelay * 1000)\n  }\n\n  onError(e: SyntheticEvent) {\n    if (this.props.onError)\n      this.props.onError(e)\n  }\n\n  // // ----------------------- functions ------------------------\n\n  disableVideoControllers() {\n    clearTimeout(this.timer)\n    this.setState({ showVideoControll: false })\n  }\n\n  setTime(timePerSeconds: number) {\n    const ve = this.videoElementRef.current\n    if (ve) ve.currentTime = timePerSeconds\n  }\n\n  shootTime(seconds: number) {\n    const ve = this.videoElementRef.current\n\n    if (ve) {\n      const currentTime = ve.currentTime\n      this.setTime(currentTime + seconds)\n    }\n  }\n\n  setPlay(play: boolean) {\n    if (this.videoElementRef.current) {\n      if (play)\n        this.videoElementRef.current?.play()\n      else\n        this.videoElementRef.current?.pause()\n    }\n  }\n\n  togglePlay() {\n    this.setPlay(!this.isPlaying())\n  }\n\n  isPlaying(): boolean {\n    return Boolean(this.videoElementRef.current && !this.videoElementRef.current.paused)\n  }\n\n  // -------------------------- component API ---------------------------\n  render() {\n    const isPlaying = this.isPlaying()\n\n    return (\n      <div className={\"video-player \" + (this.state.showVideoControll ? 'show ' : '')}\n        onMouseMove={this.onMouseMove} onMouseOut={this.disableVideoControllers}>\n\n        <div className=\"video-screen\"\n          onContextMenu={e => e.preventDefault()}>\n\n          <video\n            onTimeUpdate={this.onTimeUpdate}\n            ref={this.videoElementRef}\n            src={this.props.videoUrl}\n            autoPlay={false}\n            loop={false}\n            onDurationChange={this.onDurationChanges}\n            onError={e => this.onError(e)}\n          ></video>\n\n          <div className={\"video-state-controller\"}>\n            <div className=\"part\"></div>\n\n            <div className=\"part action-btn-group\">\n              <div className=\"action-btn play-pause\" onClick={() => this.setPlay(!isPlaying)}>\n                <span className={\"icon fas fa-3x \" + (isPlaying ? \"fa-pause\" : \"fa-play\")}>\n                </span>\n              </div>\n            </div>\n\n            <div className=\"part\"></div>\n          </div>\n\n        </div>\n      </div>\n    )\n  }\n}","import React, { MouseEvent } from 'react'\nimport hotkeys from 'hotkeys-js'\n\nimport { CircleBtn } from \"../form\"\nimport { Caption } from \"../../utils/caption\"\nimport { second2timestamp } from \"../../utils/timestamp\"\n\nimport {\n  MAX_SCALE, MAX_CANVAS_SIZE, DEFAULT_SCALE, SHOOT_ZOOM, TIMELINE_CURSOR_OFFSET\n} from \"../../utils/consts\"\n\nimport \"./subtitle-timeline.sass\"\n\ntype Props = {\n  className?: string\n\n  duration: number\n  currentTime: number\n  onSelectNewTime: (newTime: number) => void\n\n  captions: Caption[]\n  selectedCaption_i: number | null\n  onCaptionSelected: (captionIndex: number) => void\n}\ntype State = {\n  error: boolean\n  lastScale: number\n  scale: number\n}\nexport default class SubtitleTimeline extends React.Component<Props, State> {\n  canvasRef: React.RefObject<HTMLCanvasElement>\n\n  constructor(props: any) {\n    super(props)\n\n    this.state = {\n      error: false,\n      lastScale: 0,\n      scale: 0,\n    }\n\n    this.canvasRef = React.createRef()\n\n    // --- method binding ---\n    this.captionSelectionHandler = this.captionSelectionHandler.bind(this)\n    this.drawTimeRuler = this.drawTimeRuler.bind(this)\n    this.setTimeFromPixels = this.setTimeFromPixels.bind(this)\n\n    this.zoom = this.zoom.bind(this)\n    this.zoomIn = this.zoomIn.bind(this)\n    this.zoomOut = this.zoomOut.bind(this)\n    this.isZoomInValid = this.isZoomInValid.bind(this)\n    this.isZoomOutValid = this.isZoomOutValid.bind(this)\n  }\n\n  // --------------------------- methods ---------------------\n  captionSelectionHandler(index: number) {\n    this.props.onCaptionSelected(index)\n  }\n\n  zoom(value: number) {\n    const new_val = this.state.scale + value\n\n    if (this.isZoomInValid(new_val) && this.isZoomOutValid(new_val))\n      this.setState({ scale: new_val })\n  }\n  isZoomInValid(val: number): boolean {\n    return (val <= MAX_SCALE) && (val * this.props.duration <= MAX_CANVAS_SIZE)\n  }\n  isZoomOutValid(val: number) {\n    return val > 0\n  }\n  zoomIn() {\n    this.zoom(+SHOOT_ZOOM)\n  }\n  zoomOut() {\n    this.zoom(-SHOOT_ZOOM)\n  }\n\n  setTimeFromPixels(timePerPixels: number) {\n    this.props.onSelectNewTime(timePerPixels / this.state.scale)\n  }\n\n  drawTimeRuler() {\n    const ctx = this.canvasRef.current?.getContext('2d')\n    if (ctx)\n      for (let second = 0; second < this.props.duration; second++) {\n        const time = second2timestamp(second, \"minute\")\n\n        if (this.state.scale < 20) {\n          if (second % 5 === 0)\n            ctx.fillText(time, this.state.scale * second - 12, 20)\n        }\n        else if (this.state.scale < 30) {\n          if (second % 3 === 0)\n            ctx.fillText(time, this.state.scale * second - 12, 20)\n        }\n        else if (this.state.scale < 40) {\n          ctx.fillText(time, this.state.scale * second - 12, second % 2 === 1 ? 12 : 20)\n        }\n        else {\n          ctx.fillText(time, this.state.scale * second - 12, 20)\n        }\n\n        ctx.fillRect(this.state.scale * second, 24, 2, 10)\n      }\n  }\n\n  //  ------------------- component API ----------------------\n  componentDidMount() {\n    // --- register shortcuts\n    hotkeys('ctrl+=', kv => {\n      kv.preventDefault()\n      this.zoomIn()\n    })\n    hotkeys('ctrl+-', kv => {\n      kv.preventDefault()\n      this.zoomOut()\n    })\n  }\n\n  componentDidUpdate() {\n    if (this.props.duration === 0) return\n\n    if (this.state.scale === 0) {\n      let currentScale = DEFAULT_SCALE\n      while (currentScale * this.props.duration > MAX_CANVAS_SIZE)\n        currentScale -= SHOOT_ZOOM\n\n      if (currentScale <= 0)\n        this.setState({ error: true, scale: -1 })\n      else\n        this.setState({ scale: currentScale })\n    }\n\n    // to prevent useless rerender\n    else if (this.state.lastScale !== this.state.scale) {\n      this.setState({ lastScale: this.state.scale }, this.drawTimeRuler)\n    }\n  }\n\n  render() {\n    if (this.state.error)\n      return (<div className=\"center badge-danger\">\n        sorry the video length is too large - web browsers have limit for canvas size\n      </div>)\n\n    const\n      scale = this.state.scale,\n      duration = this.props.duration,\n      percent = -(this.props.currentTime - TIMELINE_CURSOR_OFFSET) / duration * 100\n\n    return (\n      <div className={\"advanced-timeline \" + this.props.className}>\n\n        <div className=\"side-bar\">\n          <CircleBtn\n            className=\"mb-1\"\n            onClick={this.zoomIn}\n            disabled={!this.isZoomInValid(this.state.scale + SHOOT_ZOOM)}\n            iconClassName=\"fas fa-search-plus\"\n          />\n\n          <div className=\"center scale-text\">\n            {scale}\n          </div>\n\n          <CircleBtn\n            className=\"mb-1\"\n            onClick={this.zoomOut}\n            disabled={!this.isZoomOutValid(this.state.scale - SHOOT_ZOOM)}\n            iconClassName=\"fas fa-search-minus\"\n          />\n        </div>\n\n        <div className=\"advanced-timeline-wrapper\">\n\n          <div className=\"current-time-cursor\" style={{\n            marginLeft: `${TIMELINE_CURSOR_OFFSET * scale}px`,\n          }}></div>\n\n          <div className=\"mover\" style={{\n            transform: `translateX(${percent}%)`,\n            width: `${duration * scale}px`,\n          }}>\n\n            <div className=\"time-ruler-wrapper\">\n              <canvas className=\"time-ruler\" ref={this.canvasRef}\n                width={duration * scale} height=\"32\"></canvas>\n\n              <UserCursorElem onTimePick={this.setTimeFromPixels} />\n            </div>\n\n            <div className=\"captions-side\">\n              {this.props.captions.map((c: Caption, i) =>\n                captionItem(c, i, this.props.selectedCaption_i, this.captionSelectionHandler, scale))\n              }\n            </div>\n\n          </div>\n        </div>\n\n      </div>\n    )\n  }\n}\n\n// captions\nfunction captionItem(c: Caption, index: number, selected_i: null | number, clickFunc: (index: number) => void, scale: number): JSX.Element {\n  const width = c.end - c.start\n\n  return (\n    <div className={\"caption-item \" + (selected_i === index ? 'selected' : '')}\n      key={c.hash} onClick={e => clickFunc(index)}\n      style={{\n        left: `${c.start * scale}px`,\n        width: `${width * scale}px`\n      }}>\n\n      <span>{c.content}</span>\n    </div>\n  )\n}\n\ntype USPROPS = {\n  onTimePick: (userCursorX: number) => void\n}\nclass UserCursorElem extends React.Component<USPROPS> {\n  state = { cursorXPos: 0 }\n\n  calculateRealOffset(e: MouseEvent) {\n    const mouseX = e.pageX, // based on the screen\n      PostionOfElem = e.currentTarget.getBoundingClientRect()\n\n    return mouseX - PostionOfElem.left\n  }\n\n  render() {\n    return (\n      <div className=\"user-time-cursor-wrapper\"\n        onMouseMove={e => this.setState({ cursorXPos: this.calculateRealOffset(e) })}\n        onMouseLeave={() => this.setState({ cursorXPos: 0 })}\n        onClick={e => this.props.onTimePick(this.calculateRealOffset(e))} >\n\n        <div className=\"user-time-cursor\"\n          style={{ transform: `translateX(${this.state.cursorXPos}px)` }}></div>\n      </div >\n    )\n  }\n}","export const\n  MAX_HISTORY = 300,\n  SHOOT_TIME_MAJOR = 5,\n  SHOOT_TIME_MINOR = 0.5,\n\n  SHOOT_SUBTITLE_TIME_MAJOR = 0.5,\n  SHOOT_SUBTITLE_TIME_MINOR = 0.1,\n\n  ADD_CAPTION_TIME = 0.3,\n  \n  TIMELINE_CURSOR_OFFSET = 4, // per seconds\n  \n  SHOOT_ZOOM  = 10,\n  MAX_CANVAS_SIZE = 32767,\n  DEFAULT_SCALE = 30,\n  MAX_SCALE = 100\n\n","import React, { SyntheticEvent } from 'react'\nimport hotkeys from 'hotkeys-js'\nimport { v4 as uuid } from \"uuid\"\n\nimport appStates from \"../utils/states\"\nimport { Caption, export2srt, captionsCompare } from \"../utils/caption\"\nimport { SHOOT_TIME_MINOR, SHOOT_TIME_MAJOR, MAX_HISTORY } from \"../utils/consts\"\n\nimport { VideoPlayer, Timeline, SubtitleTimeline, CaptionEditor, CaptionView } from \"../components/video\"\nimport { CircleBtn, pushToast } from \"../components/form\"\n\nimport \"./studio.sass\"\nconst fileDownload = require('js-file-download')\n\nenum ActionTypes { Delete, Create, Change }\ntype ActionHistory = {\n  type: ActionTypes\n  changes: Caption[]\n}\n\ntype State = {\n  videoUrl: string\n\n  currentTime: number\n  totalTime: number\n\n  captions: Caption[]\n  selected_caption_i: number | null\n\n  historyCursor: number\n  capsHistory: ActionHistory[] // the last state is always is in the last index\n}\nexport default class Studio extends React.Component<{}, State> {\n\n  VideoPlayerRef: React.RefObject<VideoPlayer>\n\n  constructor(props: any) {\n    super(props)\n\n    this.state = {\n      videoUrl: appStates.videoUrl.getData(),\n\n      currentTime: 0,\n      totalTime: 0,\n\n      captions: [],\n      selected_caption_i: null,\n\n      historyCursor: -1,\n      capsHistory: []\n    }\n\n    this.VideoPlayerRef = React.createRef()\n\n    // --- bind methods ---\n    this.onTimeUpdate = this.onTimeUpdate.bind(this)\n    this.onVideoError = this.onVideoError.bind(this)\n\n    this.addCaptionUIHandler = this.addCaptionUIHandler.bind(this)\n    this.addCaptionObject = this.addCaptionObject.bind(this)\n    this.changeCaptionUIHandler = this.changeCaptionUIHandler.bind(this)\n    this.changeCaptionObject = this.changeCaptionObject.bind(this)\n    this.deleteCaptionUIHandler = this.deleteCaptionUIHandler.bind(this)\n    this.deleteCaptionObject = this.deleteCaptionObject.bind(this)\n    this.captionSelectionToggle = this.captionSelectionToggle.bind(this)\n\n    this.updateHistoryCursor = this.updateHistoryCursor.bind(this)\n    this.undoRedo = this.undoRedo.bind(this)\n\n    this.saveFile = this.saveFile.bind(this)\n  }\n\n  // ------------- component API -----------------\n\n  componentDidMount() {\n    // --- init states ---\n    const initCaps = appStates.subtitles.getData()\n    this.setState({ captions: initCaps })\n\n    // --- bind shortcuts ---\n    hotkeys.filter = () => true // to make it work also in input elements\n\n    hotkeys('alt+*, tab, shift+tab', kv => kv.preventDefault())\n\n    hotkeys('ctrl+shift+left', kv => {\n      if (this.state.selected_caption_i === null) {\n        kv.preventDefault()\n        this.VideoPlayerRef.current?.shootTime(-SHOOT_TIME_MAJOR)\n      }\n    })\n    hotkeys('ctrl+shift+right', kv => {\n      if (this.state.selected_caption_i === null) {\n        kv.preventDefault()\n        this.VideoPlayerRef.current?.shootTime(+SHOOT_TIME_MAJOR)\n      }\n    })\n    hotkeys('ctrl+left', kv => {\n      kv.preventDefault()\n      this.VideoPlayerRef.current?.shootTime(-SHOOT_TIME_MINOR)\n    })\n    hotkeys('ctrl+right', kv => {\n      kv.preventDefault()\n      this.VideoPlayerRef.current?.shootTime(+SHOOT_TIME_MINOR)\n    })\n    hotkeys('home', kv => {\n      kv.preventDefault()\n      this.VideoPlayerRef.current?.setTime(0)\n    })\n    hotkeys('end', kv => {\n      kv.preventDefault()\n      this.VideoPlayerRef.current?.setTime(this.state.totalTime)\n    })\n\n    hotkeys('ctrl+enter', () => this.addCaptionUIHandler())\n\n    hotkeys('ctrl+down', kv => {\n      kv.preventDefault()\n\n      const t = this.state.currentTime,\n        i = this.state.captions.findIndex(c => t >= c.start && t <= c.end)\n\n      if (i !== -1)\n        this.setState({ selected_caption_i: i })\n    })\n    hotkeys('escape', kv => {\n      kv.preventDefault()\n      this.setState({ selected_caption_i: null })\n    })\n\n    hotkeys('space', kv => {\n      // @ts-ignore\n      if (kv.target.tagName !== 'INPUT')\n        kv.preventDefault()\n    })\n    hotkeys('ctrl+space', kv => {\n      this.VideoPlayerRef.current?.togglePlay()\n    })\n\n    hotkeys('ctrl+delete', () => this.deleteCaptionUIHandler())\n\n    hotkeys('ctrl+z', () => this.undoRedo(true))\n    hotkeys('ctrl+y', () => this.undoRedo(false))\n    hotkeys('ctrl+s', kv => {\n      kv.preventDefault()\n      this.saveFile()\n    })\n  }\n  componentWillUnmount() {\n    hotkeys.unbind()\n  }\n\n  // ----------- video player events -------------------\n\n  onTimeUpdate(nt: number) { // nt: new time\n    const sci = this.state.selected_caption_i\n    if (sci !== null) {\n      const cap = this.state.captions[sci],\n        ve = this.VideoPlayerRef,\n        isplying = ve.current?.isPlaying()\n\n      if (nt >= cap.end) {\n        if (isplying) {\n          ve.current?.setPlay(false)\n          ve.current?.setTime(cap.start)\n        }\n      }\n      else if (nt < cap.start) {\n        if (isplying)\n          ve.current?.setTime(cap.start)\n      }\n    }\n\n    this.setState({ currentTime: nt })\n  }\n\n  onVideoError(e: SyntheticEvent) {\n    pushToast({\n      kind: 'danger',\n      message: \"error happend while loading video\",\n      duration: 5000\n    })\n  }\n\n  // ----------------- functionalities --------------------\n\n  addCaptionObject(newCap: Caption): object {\n    return { captions: [...this.state.captions, newCap] }\n  }\n\n  addCaptionUIHandler() {\n    const\n      t = this.state.currentTime,\n      newCap = {\n        start: t,\n        end: t + 1,\n        content: \"New Caption\",\n        hash: uuid(),\n      }\n\n    this.setState({\n      capsHistory: [...this.state.capsHistory, {\n        type: ActionTypes.Create,\n        changes: [newCap,]\n      }],\n      ...this.addCaptionObject(newCap),\n      selected_caption_i: this.state.captions.length\n\n    }, this.updateHistoryCursor)\n  }\n\n  changeCaptionObject(fromCap: Caption, toCap: Caption): object {\n    return {\n      captions: this.state.captions.map(c => c.hash === fromCap.hash ? toCap : c)\n    }\n  }\n  changeCaptionUIHandler(oldCap: Caption, newCap: Caption) {\n    const\n      oldCapIndex = this.state.captions.findIndex(c => c.hash === oldCap.hash)\n\n    if (oldCapIndex === -1) return // it can happen due to fast repeative user actions\n\n    this.setState(\n      {\n        capsHistory: [...this.state.capsHistory, {\n          type: ActionTypes.Change,\n          changes: [oldCap, newCap]\n        }],\n        ...this.changeCaptionObject(oldCap, newCap)\n      }\n\n      , this.updateHistoryCursor\n    )\n  }\n\n  deleteCaptionObject(selected_caption_index: number): object {\n    return {\n      captions: this.state.captions.filter(\n        (_, i) => i !== selected_caption_index),\n    }\n  }\n\n  deleteCaptionUIHandler() {\n    const ls = this.state // last state\n    if (ls.selected_caption_i === null) return\n\n    this.setState({\n      capsHistory: [...ls.capsHistory, {\n        type: ActionTypes.Delete,\n        changes: [ls.captions[ls.selected_caption_i],]\n      }],\n\n      selected_caption_i: null,\n      ...this.deleteCaptionObject(ls.selected_caption_i),\n\n    }, this.updateHistoryCursor)\n  }\n\n  captionSelectionToggle(index: number) {\n    this.setState({\n      selected_caption_i:\n        this.state.selected_caption_i === index ? null : index\n    })\n  }\n\n  updateHistoryCursor() {\n    const hc = this.state.historyCursor\n    let lastHistory = this.state.capsHistory\n\n    // [0, 1, 2, 3], c:2 => [0, 1, 2]\n    if (hc + 1 !== lastHistory.length - 1) // if it didn't point on the last history before updating history\n      lastHistory = lastHistory.slice(0, hc + 2)\n\n    // [1, 2, 3, 4] => [2, 3, 4]\n    else if (lastHistory.length >= MAX_HISTORY)\n      lastHistory.splice(0, 1)\n\n    this.setState({\n      capsHistory: lastHistory,\n      historyCursor: lastHistory.length - 1\n    })\n  }\n\n  undoRedo(undo: boolean) {\n    const\n      hc = this.state.historyCursor,\n      redo = !undo,\n      history = this.state.capsHistory\n\n    let newState: object\n\n    // out of range check\n    if (!((undo && (hc >= 0)) || (redo && (hc + 1 < history.length)))) return\n\n    let\n      caps = this.state.captions,\n      lastAction = history[hc + (undo ? 0 : +1)]\n\n    if (\n      (undo && lastAction.type === ActionTypes.Create) ||\n      (redo && lastAction.type === ActionTypes.Delete)\n    ) {\n      newState =\n        this.deleteCaptionObject(caps.findIndex(c => c.hash === lastAction.changes[0].hash))\n    }\n\n    else if (\n      (undo && lastAction.type === ActionTypes.Delete) ||\n      (redo && lastAction.type === ActionTypes.Create)\n    ) {\n      newState = this.addCaptionObject(lastAction.changes[0])\n    }\n\n    else {\n      if (undo)\n        newState = this.changeCaptionObject(lastAction.changes[1], lastAction.changes[0])\n      else // redo\n        newState = this.changeCaptionObject(lastAction.changes[0], lastAction.changes[1])\n    }\n\n    this.setState({\n      ...newState,\n      selected_caption_i: null,\n      historyCursor: hc + (undo ? -1 : +1),\n    })\n  }\n\n  saveFile() {\n    this.state.captions.sort(captionsCompare)\n    fileDownload(export2srt(this.state.captions), 'subtitle.srt');\n  }\n\n  render() {\n    const\n      caps = this.state.captions,\n      selected_ci = this.state.selected_caption_i\n\n    return (<>\n      <h2 className=\"page-title\">Studio</h2>\n      <div className=\"wrapper\">\n\n        <div className=\"video-wrapper\">\n          <VideoPlayer\n            ref={this.VideoPlayerRef}\n            videoUrl={this.state.videoUrl}\n            onTimeUpdate={this.onTimeUpdate}\n            onError={this.onVideoError}\n            onDurationChanges={du => this.setState({ totalTime: du })}\n          />\n        </div>\n\n        <CaptionView\n          currentTime={this.state.currentTime}\n          captions={caps}\n        />\n        <Timeline\n          className=\"my-2\"\n          currentTime={this.state.currentTime}\n          totalTime={this.state.totalTime}\n          onSelectNewTime={nt => this.VideoPlayerRef.current?.setTime(nt)}\n        />\n\n        <div className=\"d-flex justify-content-center action-button-group my-2\">\n          <CircleBtn\n            iconClassName=\"fas fa-plus\"\n            text=\"add caption\"\n            onClick={this.addCaptionUIHandler}\n          />\n          <CircleBtn\n            iconClassName=\"fas fa-undo\"\n            disabled={this.state.historyCursor === -1}\n            text={\"undo \" + (this.state.historyCursor + 1)}\n            onClick={() => this.undoRedo(true)}\n          />\n\n          <CircleBtn\n            iconClassName=\"fas fa-redo\" // [0, 1, 2, 3]\n            text={\"redo \" + ((this.state.capsHistory.length - 1) - this.state.historyCursor)}\n            disabled={this.state.historyCursor >= this.state.capsHistory.length - 1}\n            onClick={() => this.undoRedo(false)}\n          />\n\n          <CircleBtn\n            iconClassName=\"fas fa-times\"\n            disabled={this.state.selected_caption_i === null}\n            text=\"unselect\"\n            onClick={() => this.setState({ selected_caption_i: null })}\n          />\n\n          <CircleBtn\n            iconClassName=\"fas fa-trash\"\n            disabled={this.state.selected_caption_i === null}\n            text=\"delete\"\n            onClick={this.deleteCaptionUIHandler}\n          />\n\n        </div>\n\n        <SubtitleTimeline\n          className=\"my-1\"\n          duration={this.state.totalTime}\n          currentTime={this.state.currentTime}\n          onSelectNewTime={nt => this.VideoPlayerRef.current?.setTime(nt)}\n\n          captions={caps}\n          onCaptionSelected={this.captionSelectionToggle}\n          selectedCaption_i={selected_ci}\n        />\n\n        <CaptionEditor\n          currentTime={this.state.currentTime}\n          totalTime={this.state.totalTime}\n          caption={selected_ci === null ? null : caps[selected_ci]}\n          onCaptionChanged={this.changeCaptionUIHandler}\n        />\n\n      </div>\n\n      <div className=\"d-flex justify-content-center my-2\">\n        <button className=\"btn btn-danger\" onClick={this.saveFile}>\n          <strong> save as a file <span className=\"fas fa-file\"></span>  </strong>\n        </button>\n      </div>\n    </>)\n  }\n}","import React, { ChangeEvent, FocusEvent } from 'react'\nimport { second2timestamp, timestamp2seconds } from \"../../utils/timestamp\"\n\nimport { CircleBtn } from \"../form\"\nimport { SHOOT_SUBTITLE_TIME_MAJOR, SHOOT_SUBTITLE_TIME_MINOR } from \"../../utils/consts\";\n\nimport './time-controll.sass'\n\ntype Props = {\n  time: number // per seconds\n  onChange?: (changedValue: number | null) => void\n}\ntype State = {\n  isEditing: boolean\n  timeEditing: string\n}\nexport default class TimeControll extends React.Component<Props, State> {\n  constructor(props: any) {\n    super(props)\n\n    this.state = {\n      isEditing: false,\n      timeEditing: ''\n    }\n\n    this.changeHandler = this.changeHandler.bind(this)\n    this.changeTimeEditing = this.changeTimeEditing.bind(this)\n    this.textEditorTimeChange = this.textEditorTimeChange.bind(this)\n  }\n\n  changeEditingState(val: boolean) {\n    if (this.props.onChange)\n      this.setState({\n        isEditing: val,\n        timeEditing: val ? second2timestamp(this.props.time, \"complete\") : ''\n      })\n  }\n\n  textEditorTimeChange(e: FocusEvent<HTMLInputElement>) {\n    const newTimeString = e.target.value\n    let newTime: number\n\n\n    try { newTime = timestamp2seconds(newTimeString) }\n    catch (error) { return }\n\n    const delataTime = newTime - this.props.time\n\n    this.changeHandler(delataTime)\n    this.changeEditingState(false)\n  }\n\n  changeTimeEditing(e: ChangeEvent<HTMLInputElement>) {\n    this.setState({ timeEditing: e.target.value })\n  }\n\n  changeHandler(changedValue: number | null) {\n    if (this.props.onChange)\n      this.props.onChange(changedValue)\n  }\n\n  render() {\n    const\n      disabled = this.props.onChange === undefined,\n      time = second2timestamp(this.props.time, \"complete\"),\n\n      timeElem = this.state.isEditing ?\n        (<div className=\"time-editor\">\n          <input type=\"text\" className=\"time-text-editor\"\n            onChange={this.changeTimeEditing} value={this.state.timeEditing}\n            autoFocus onBlur={this.textEditorTimeChange} />\n        </div>\n        ) : (\n          <div className=\"time-text\" onDoubleClick={() => this.changeEditingState(true)}>\n            <span> {time} </span>\n          </div>\n        )\n\n    return (\n      <div className=\"time-control-wrapper\">\n        <CircleBtn\n          className=\"time-control-btn minus-time\"\n          disabled={disabled}\n          iconClassName=\"fas fa-minus\"\n          onClick={() => this.changeHandler(-SHOOT_SUBTITLE_TIME_MAJOR)}\n        />\n\n        <CircleBtn\n          className=\"time-control-btn minus-time little\"\n          disabled={disabled}\n          onClick={() => this.changeHandler(-SHOOT_SUBTITLE_TIME_MINOR)}\n          iconClassName=\"fas fa-minus\"\n        />\n\n        {timeElem}\n\n        <CircleBtn\n          className=\"time-control-btn add-time little\"\n          disabled={disabled}\n\n          onClick={() => this.changeHandler(+SHOOT_SUBTITLE_TIME_MINOR)}\n          iconClassName=\"fas fa-plus\"\n        />\n\n        <CircleBtn\n          className=\"time-control-btn add-time\"\n          disabled={disabled}\n          onClick={() => this.changeHandler(+SHOOT_SUBTITLE_TIME_MAJOR)}\n          iconClassName=\"fas fa-plus\"\n        />\n\n        <CircleBtn\n          className=\"time-control-btn add-time\"\n          disabled={disabled}\n          onClick={() => this.changeHandler(null)}\n          iconClassName=\"fas fa-angle-double-up\"\n        />\n      </div>\n    )\n  }\n}\n","export default __webpack_public_path__ + \"static/media/TimeControll.ba1b4269.jpg\";","export default __webpack_public_path__ + \"static/media/stickTime.ee5d02c9.png\";","import React from 'react'\nimport './help.sass'\n\nimport TCtrolImg from '../assets/TimeControll.jpg'\nimport StickTimeImg from '../assets/stickTime.png'\n\ntype State = {\n  shortcuts: {\n    keys: string[],\n    clue: string,\n  }[]\n}\nexport default class Help extends React.Component<{}, State> {\n  state = {\n    shortcuts: [\n      {\n        keys: ['ctrl', 'enter'],\n        clue: 'play/pause video player',\n      },\n      {\n        keys: ['ctrl', 'right/left'],\n        clue: 'go forward/backward in timeline [small step]',\n      },\n      {\n        keys: ['ctrl', 'shift', 'right/left'],\n        clue: 'go forward/backward in timeline [big step]',\n      },\n      {\n        keys: ['home/end'],\n        clue: 'shoot time to start/end of the video',\n      },\n      {\n        keys: ['ctrl', '+/-'],\n        clue: 'zoom in/out in timeline',\n      },\n      {\n        keys: ['ctrl', 'shift', '+/-'],\n        clue: 'zoom in/out web page',\n      },\n\n      {\n        keys: ['ctrl', 'down'],\n        clue: 'select current caption',\n      },\n      {\n        keys: ['escape'],\n        clue: 'unselect selected caption',\n      },\n\n      {\n        keys: ['tab', 'left/right'],\n        clue: 'shoot end of selected caption forward/backward',\n      },\n      {\n        keys: ['alt', 'left/right'],\n        clue: 'shoot start of selected caption forward/backward',\n      },\n      {\n        keys: ['ctrl','home/end'],\n        clue: 'shoot start/end of selected caption to the current time',\n      },\n      {\n        keys: ['ctrl', 'enter'],\n        clue: 'create new caption',\n      },\n      {\n        keys: ['ctrl', 'delete'],\n        clue: 'delete selected caption',\n      },\n      {\n        keys: ['ctrl', '[/]'],\n        clue: 'set text direction in caption editor input left-to-right/right-to-left',\n      },\n\n      {\n        keys: ['ctrl', 'z/y'],\n        clue: 'undo/redo',\n      },\n\n      {\n        keys: ['ctrl', 's'],\n        clue: 'save subtitle',\n      },\n    ]\n  }\n\n  render() {\n    return (<>\n      <h2 className=\"page-title\">Help</h2>\n      <div className=\"wrapper\">\n\n        <h3> <a href=\"#features\">#features</a> </h3>\n        <ul id=\"features\">\n\n          <li>\n            <img src={TCtrolImg} height=\"180\" className=\"d-block\" alt=\"\" />\n            <span>\n              you can change timestamp manually by double clicking on it\n              changes will be applied after clicking out of the timestamp\n            </span>\n          </li>\n\n          <li>\n            <img src={StickTimeImg} height=\"180\" className=\"d-block\" alt=\"\" />\n            <span>\n              use stick time button to stick start/end of selected caption to the timeline cursor\n            </span>\n          </li>\n\n        </ul>\n\n        <h3> <a href=\"#shortcuts\">#shortcuts</a> </h3>\n        <ul id=\"shortcuts\">\n          {this.state.shortcuts.map(sh => (\n            <li className=\"shortcut d-flex justify-content-between\">\n              <span className=\"keys\">\n                {sh.keys.map((k, i) => <>\n                  {i !== 0 ? <span className=\"plus\">+</span> : ''}\n                  <code className=\"key\">{k}</code>\n                </>)}\n              </span>\n\n              <span className=\"clue\"> {sh.clue} </span>\n            </li>\n          ))}\n\n        </ul>\n\n      </div></>)\n  }\n}","import React from 'react'\nimport { BrowserRouter as Router, Route } from 'react-router-dom'\n\nimport { Intro, Studio, Help } from \"./pages\"\nimport { Toast } from \"./components/form\"\n\nimport \"./global.sass\"\n\nexport default class App extends React.Component {\n  render() {\n    return (<>\n      <Router basename=\"/subtitle-edtior\">\n        <Route exact path='/' component={Intro}></Route>\n        <Route exact path='/studio' component={Studio}></Route>\n        <Route exact path='/help' component={Help}></Route>\n      </Router>\n      <Toast />\n    </>)\n  }\n}","import React from 'react'\nimport ReactDOM from 'react-dom'\n\nimport App from './App'\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n)\n"],"sourceRoot":""}