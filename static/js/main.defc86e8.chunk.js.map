{"version":3,"sources":["components/form/CircleBtn.tsx","components/form/FileInput.tsx","components/form/Toast.tsx","utils/storage.ts","utils/states.ts","utils/timestamp.ts","utils/caption.ts","pages/Intro.tsx","utils/browser.ts","utils/funcs.ts","components/video/CaptionEditor.tsx","components/video/CaptionView.tsx","components/video/SimpleTimeline.tsx","components/video/VideoPlayer.tsx","components/video/SubtitleTimeLine.tsx","utils/consts.ts","components/video/TimeControll.tsx","pages/Studio.tsx","assets/captionDrag.gif","assets/TimeControll.jpg","assets/stickTime.png","assets/textAlign.png","assets/addNewCaptionToEndOfLastOne.jpg","assets/resizeVideo.png","pages/Help.tsx","App.tsx","index.tsx"],"names":["CircleBtn","className","this","props","disabled","onClick","iconClassName","text","React","Component","FileInput","fileInput","createRef","changeHandler","bind","redirectToInput","e","inputFileElem","target","onChange","files","length","file","current","click","filename","placeHolder","type","ref","pushToast","t","ev","CustomEvent","detail","window","dispatchEvent","Toast","state","isOpen","timerId","lastMessage","kind","message","duration","disableToast","cancelToast","cancelTimer","clearTimeout","setState","console","log","timeout","setTimeout","addEventListener","removeEventListener","s","WindowStates","given_data","data","new_val","obj","videoUrl","subtitles","digitalClock","num","numberOfZeroes","i","tens","Math","pow","repeat","String","second2timestamp","total_seconds","mode","miliseconds","floor","seconds","minutes","hours","timestamp2seconds","timestamp","Number","slice","captionsCompare","a","b","start","Intro","subtitleUrl","canPass","subtitleFname","videoFname","handler","loadCaptions","loadVideo","checkValidation","params","Object","fromEntries","URLSearchParams","location","search","entries","sub","vid","basename","url","fname","fetch","response","appStates","setData","content","Array","from","matchAll","map","m","end","trim","hash","uuid","name","f","fileType","blob","URL","createObjectURL","to","href","simpleSort","CaptionEditor","inputRef","lastCaption","newCaption","is_ltr","onCaptionContentChanged","onCaptionTimeRangeChanged","handleCaptionChange","isCapInTimeRange","hotkeys","kv","preventDefault","caption","newPropCap","time","totalTime","newCap","value","startChange","endChange","cap","currentTime","onCaptionChanged","captionIndex","focus","blur","changeValue","ls","onBlur","CaptionView","getCaptionContent","captions","find","c","SimpleTimeline","handleClick","onSelectNewTime","element","currentTarget","pageX","offsetLeft","clientWidth","undefined","widthPercent","style","width","VideoPlayer","videoElementRef","timer","lastStart","showVideoControll","onTimeUpdate","onMouseMove","onError","setPlay","isPlaying","disableVideoControllers","onDurationChanges","du","videoControllHiddingDelay","timePerSeconds","ve","setTime","play","pause","Boolean","paused","onMouseOut","onContextMenu","height","src","autoPlay","loop","onDurationChange","SubtitleTimeline","canvasRef","group","error","lastScale","scale","cursorXPos","timeRulers","captionSelectionHandler","initTimeRuler","updateRuler","setTimeFromPixels","zoom","zoomIn","zoomOut","isZoomInValid","isZoomOutValid","calculateRealOffset","index","onCaptionSelected","val","getBoundingClientRect","left","timePerPixels","stage","Konva","Stage","container","innerWidth","layer","Layer","Group","add","cachedTimeRulers","maximumSecondsPerChunk","d","progress","limit","min","second","common","x","y","fontSize","fontFamily","Text","Rect","fill","push","toDataURL","destroyChildren","marginLeft","onMouseLeave","posx","onclick","transform","transition","dataUrl","alt","selected_i","selectedCaption_i","clickFunc","CaptionItem","cachedCap","onDragCenterStop","onDragHeadStop","onDragTailStop","dd","u","lastX","isSelected","axis","position","onStop","UserCursorElem","TimeControll","isEditing","timeEditing","changeTimeEditing","textEditorTimeChange","newTime","newTimeString","delataTime","changeEditingState","changedValue","timeElem","autoFocus","onDoubleClick","fileDownload","require","Studio","VideoPlayerRef","getData","videoHeight","acc","subFileName","selected_caption_i","historyCursor","history","onVideoError","handleSeparatorDrag","handleSeparatorStop","addCaptionUIHandler","changeCaptionUIHandler","changeCaptionObject","deleteCaptionUIHandler","deleteCaptionObject","captionSelectionToggle","updatedHistory","undoRedo","goToLastStart","goToNextEnd","saveFile","initCaps","filter","shootTime","findIndex","tagName","togglePlay","unbind","nt","sci","isplying","newcap","arr","repl","assign","copy","lastIndex","pop","ct","currentCap","caps","concat","h","li","undo","hc","dir","ends","sort","starts","join","deltaY","selected_ci","onDrag","placeholder","Help","shortcuts","keys","clue","features","imageSrc","captionDrag","details","TCtrolImg","StickTimeImg","TextAlignImg","addNewCap2Last","resizeVideo","id","sh","k","App","exact","path","component","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.defc86e8.chunk.js","sourcesContent":["import React, { MouseEvent } from 'react'\r\n\r\nimport './circle-btn.sass'\r\n\r\ntype Props = {\r\n  text?: string\r\n  className?: string\r\n  iconClassName: string\r\n  disabled?: boolean\r\n  onClick: (me: MouseEvent) => void\r\n}\r\n\r\nexport default class CircleBtn extends React.Component<Props> {\r\n\r\n  render() {\r\n    return (<>\r\n      <div className={\"d-inline-block \" + this.props.className}>\r\n        <button className={\"btn circle-btn add-caption-btn \" + (this.props.disabled ? 'disabled' : '')}\r\n          onClick={this.props.onClick}>\r\n          <span className={this.props.iconClassName}></span>\r\n        </button>\r\n\r\n        {this.props.text ? (\r\n          <div className=\"badge\">\r\n            <span> {this.props.text} </span>\r\n          </div>\r\n        ) : ''}\r\n      </div>\r\n    </>)\r\n  }\r\n}\r\n\r\n","import React, { ChangeEvent, createRef, RefObject } from 'react'\r\nimport './file-input.sass'\r\n\r\n\r\nclass FileInput extends React.Component<{\r\n\tonChange?: (f: File) => void\r\n\tfilename: string\r\n}, {}> {\r\n\r\n\tfileInput: RefObject<HTMLInputElement>\r\n\r\n\tconstructor(props: any) {\r\n\t\tsuper(props)\r\n\r\n\t\tthis.fileInput = createRef()\r\n\r\n\t\tthis.changeHandler = this.changeHandler.bind(this)\r\n\t\tthis.redirectToInput = this.redirectToInput.bind(this)\r\n\t}\r\n\r\n\tchangeHandler(e: ChangeEvent<HTMLInputElement>) {\r\n\t\tconst inputFileElem = e.target\r\n\r\n\t\t// send selected file to it\r\n\t\tif (this.props.onChange && inputFileElem.files?.length) {\r\n\t\t\tconst file = inputFileElem.files[0]\r\n\t\t\tthis.props.onChange(file)\r\n\t\t}\r\n\t}\r\n\r\n\tredirectToInput() {\r\n\t\tthis.fileInput.current?.click()\r\n\t}\r\n\r\n\trender() {\r\n\t\tconst\r\n\t\t\tfilename = this.props.filename,\r\n\t\t\tplaceHolder = filename ? `[${filename}] click to rechoose` : 'choose a file'\r\n\r\n\t\treturn (\r\n\t\t\t<div className=\"form-group file-input-wrapper\">\r\n\t\t\t\t<input type=\"file\" ref={this.fileInput} className=\"d-none\"\r\n\t\t\t\t\tonChange={this.changeHandler} />\r\n\r\n\t\t\t\t<button\r\n\t\t\t\t\tclassName=\"rounded font-weight-bold btn btn-info w-100 virtual-file-input\"\r\n\t\t\t\t\tonClick={e => this.redirectToInput()}>\r\n\t\t\t\t\t<span> {placeHolder} </span>\r\n\t\t\t\t</button>\r\n\r\n\t\t\t</div>\r\n\t\t)\r\n\t}\r\n}\r\n\r\nexport default FileInput","import React from 'react'\r\n\r\nexport type ToastData = {\r\n  kind: \"danger\" | \"warning\" | \"success\"\r\n  message: string,\r\n  duration: number\r\n}\r\n\r\nexport function pushToast(t: ToastData) {\r\n  const ev = new CustomEvent('toast', { detail: t })\r\n  window.dispatchEvent(ev)\r\n}\r\n\r\ntype State = {\r\n  isOpen: boolean,\r\n  timerId: number,\r\n\r\n  lastMessage: ToastData\r\n}\r\nexport default class Toast extends React.Component<{}, State> {\r\n  constructor(props: any) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      isOpen: false,\r\n      timerId: 0,\r\n      lastMessage: { kind: \"success\", message: \"\", duration: 0 }\r\n    }\r\n\r\n    this.disableToast = this.disableToast.bind(this)\r\n    this.cancelToast = this.cancelToast.bind(this)\r\n    this.cancelTimer = this.cancelTimer.bind(this)\r\n  }\r\n\r\n  // --------------- functionalities ----------------\r\n  cancelTimer() {\r\n    if (this.state.timerId) {\r\n      clearTimeout(this.state.timerId)\r\n      this.setState({ timerId: 0 })\r\n    }\r\n  }\r\n\r\n  cancelToast() {\r\n    this.cancelTimer()\r\n    console.log(\"errrrr\");\r\n    this.setState({ isOpen: false })\r\n  }\r\n\r\n  disableToast(timeout: number) {\r\n    this.cancelTimer()\r\n\r\n    this.setState({\r\n      timerId: window.setTimeout(this.cancelToast, timeout)\r\n    })\r\n  }\r\n\r\n  // ------------------ component API ----------------------\r\n\r\n  componentDidMount() {\r\n    // @ts-ignore\r\n    window.addEventListener('toast', (ev: CustomEvent<ToastData>) => {\r\n      this.setState({ lastMessage: ev.detail, isOpen: true })\r\n      this.disableToast(ev.detail.duration)\r\n    })\r\n  }\r\n\r\n  componentWillUnmount() {\r\n    // @ts-ignore\r\n    window.removeEventListener('toast')\r\n  }\r\n\r\n  render() {\r\n    const s = this.state\r\n    return (<>\r\n      <div className={\"fixed-bottom m-4 alert \" +\r\n        `alert-${s.lastMessage.kind} ${s.isOpen ? \"\" : \"d-none\"}`}>\r\n        <button className=\"close\" onClick={this.cancelToast}>&times;</button>\r\n        <strong>{s.lastMessage.message}</strong>\r\n      </div>\r\n    </>)\r\n  }\r\n}\r\n\r\n","export class WindowStates<T> { // global state: just a data wrapper\r\n  data: T\r\n  constructor(given_data: T) {\r\n    this.data = given_data\r\n  }\r\n\r\n  getData(): T {\r\n    return this.data\r\n  }\r\n\r\n  setData(new_val: T) {\r\n    this.data = new_val\r\n  }\r\n}","import { WindowStates } from \"./storage\"\r\nimport { Caption } from \"./caption\"\r\n\r\nconst obj = {\r\n  videoUrl: new WindowStates<string>(''),\r\n  subtitles: new WindowStates<Caption[]>([])\r\n}\r\n\r\nexport default obj","function digitalClock(num: number, numberOfZeroes: number = 2): string {\r\n    let i = 1\r\n    while (i <= numberOfZeroes) {\r\n        const tens = Math.pow(10, i)\r\n\r\n        if (num >= tens) i++\r\n        else break\r\n    }\r\n\r\n    return '0'.repeat(numberOfZeroes - i) + String(num)\r\n}\r\n\r\n// FIXME: minutes are diffrent in diffrent modes\r\nfunction second2timestamp(total_seconds: number, mode: 'minute' | 'minute+ms' | 'complete'): string {\r\n    const miliseconds = Math.floor((total_seconds % 1) * 1000),\r\n        seconds = Math.floor(total_seconds % 60),\r\n        minutes = Math.floor((total_seconds % 3600) / 60),\r\n        hours = Math.floor(total_seconds / 3600)\r\n\r\n    if (mode === 'minute')\r\n        return `${digitalClock(minutes)}:${digitalClock(seconds)}`\r\n    else if (mode === \"minute+ms\")\r\n        return `${digitalClock(minutes)}:${digitalClock(seconds)}.${digitalClock(miliseconds, 3)}`\r\n    else if (mode === 'complete')\r\n        return `${digitalClock(hours)}:${digitalClock(minutes)}:${digitalClock(seconds)},${digitalClock(miliseconds, 3)}`\r\n    else\r\n        return ''\r\n}\r\n\r\n// for example: timestamp = 00:00:00:654\r\nfunction timestamp2seconds(timestamp: string): number {\r\n    const hours = Number(timestamp.slice(0, 2)),\r\n        minutes = Number(timestamp.slice(3, 5)),\r\n        seconds = Number(timestamp.slice(6, 8)),\r\n        miliseconds = Number(timestamp.slice(9))\r\n\r\n    return (hours * 60 * 60) + (minutes * 60) + (seconds) + (miliseconds / 1000)\r\n}\r\n\r\n\r\nexport { timestamp2seconds, second2timestamp, digitalClock, }","import { second2timestamp, timestamp2seconds } from \"./timestamp\"\r\nimport { v4 as uuid } from \"uuid\"\r\n\r\nexport type Caption = {\r\n  start: number\r\n  end: number\r\n  content: string\r\n  hash: string // for rendering\r\n}\r\n\r\nexport function captionsCompare(a: Caption, b: Caption): number {\r\n  if (a.start > b.start) return 1\r\n  else if (b.start > a.start) return -1\r\n  else return 0\r\n}\r\n\r\nexport function areSameCaptions(a: Caption, b: Caption): boolean {\r\n  return (a.start === b.start) && (a.end === b.end) && (a.content === b.content)\r\n}\r\n\r\n// save as .srt format\r\nexport function export2srt(caps: Caption[]): string {\r\n  return caps.map((c, i) =>\r\n    `${i + 1}\\n${second2timestamp(c.start, \"complete\")} --> ${second2timestamp(c.end, \"complete\")}\\n${c.content}`)\r\n    .join('\\n\\n')\r\n}\r\n\r\nexport function parseSrt(content: string): Caption[] {\r\n  const matches = Array.from(content.matchAll(\r\n    /\\d+\\n([\\d,:]{12}) --> ([\\d,:]{12})\\n(.+?)(?=\\d+\\n[\\d,:]{12}|$)/gs))\r\n\r\n  return matches.map(m => ({\r\n    start: timestamp2seconds(m[1]),\r\n    end: timestamp2seconds(m[2]),\r\n    content: m[3].trim(),\r\n    hash: uuid()\r\n  }))\r\n}","import React from 'react'\r\nimport { Link, Redirect } from \"react-router-dom\"\r\n\r\nimport { FileInput, pushToast } from \"../components/form\"\r\nimport appStates from \"../utils/states\"\r\nimport { parseSrt } from \"../utils/caption\"\r\nimport { getQueryParams } from \"../utils/browser\"\r\n\r\nimport \"./intro.sass\"\r\nimport { basename } from 'path'\r\n\r\ntype State = {\r\n  subtitleUrl: string\r\n  videoUrl: string\r\n  subtitleFname: string\r\n  videoFname: string\r\n  canPass: boolean\r\n}\r\nexport default class Intro extends React.Component<{}, State> {\r\n  constructor(props: any) {\r\n    super(props)\r\n    this.state = {\r\n      subtitleUrl: '',\r\n      videoUrl: '',\r\n      canPass: false,\r\n      subtitleFname: \"\",\r\n      videoFname: \"\"\r\n    }\r\n\r\n    this.handler = this.handler.bind(this)\r\n    this.loadCaptions = this.loadCaptions.bind(this)\r\n    this.loadVideo = this.loadVideo.bind(this)\r\n    this.checkValidation = this.checkValidation.bind(this)\r\n  }\r\n\r\n  componentDidMount() {\r\n    let\r\n      params = getQueryParams(),\r\n      sub = params[\"subtitle\"] ?? \"\",\r\n      vid = params[\"video\"] ?? \"\"\r\n\r\n      this.loadVideo(vid, basename(vid))\r\n      this.loadCaptions(sub, basename(sub))\r\n  }\r\n\r\n  async loadCaptions(url: string, fname: string) {\r\n    if (url === '') return\r\n\r\n    const\r\n      response = await fetch(url),\r\n      data = await response.text()\r\n\r\n    appStates.subtitles.setData(parseSrt(data))\r\n\r\n    this.setState({\r\n      subtitleUrl: url,\r\n      subtitleFname: fname\r\n    })\r\n  }\r\n\r\n  loadVideo(url: string, name: string) {\r\n    appStates.videoUrl.setData(url)\r\n    this.setState({ videoUrl: url, videoFname: name })\r\n  }\r\n\r\n  handler(f: File, fileType: \"video\" | \"subtitle\") {\r\n    const blob = URL.createObjectURL(f)\r\n\r\n    if (fileType === 'video')\r\n      this.loadVideo(blob, f.name)\r\n\r\n    else\r\n      this.loadCaptions(blob, f.name)\r\n  }\r\n\r\n  checkValidation() {\r\n    if (this.state.videoUrl)\r\n      this.setState({ canPass: true })\r\n\r\n    else\r\n      pushToast({\r\n        kind: 'danger',\r\n        message: \"select a video first\",\r\n        duration: 5000\r\n      })\r\n  }\r\n\r\n  render() {\r\n    if (this.state.canPass)\r\n      return <Redirect to=\"/studio\" />\r\n\r\n    return (<>\r\n      <h2 className=\"page-title\"> Intro </h2>\r\n      <div className=\"wrapper\">\r\n\r\n        <div className=\"alert alert-secondary\">\r\n          consider\r\n          <Link to=\"/help\"> help page </Link>\r\n          for learning app features & shortcuts\r\n        </div>\r\n\r\n        <div>\r\n          <span> video file: </span>\r\n          <FileInput\r\n            onChange={f => this.handler(f, 'video')}\r\n            filename={this.state.videoFname} />\r\n        </div>\r\n\r\n        <div className=\"alert alert-info\">\r\n          you can check supported video formats\r\n          <a href=\"https://en.wikipedia.org/wiki/HTML5_video\" target=\"blank\"> here </a>\r\n        </div>\r\n\r\n        <div className=\"mt-3\">\r\n          <span> subtitle file: </span>\r\n          <FileInput\r\n            onChange={f => this.handler(f, 'subtitle')}\r\n            filename={this.state.subtitleFname}\r\n          />\r\n        </div>\r\n        <div className=\"alert alert-warning\">\r\n          if you don't select a subtitle file, we make new one\r\n        </div>\r\n\r\n        <div className=\"center\">\r\n          <button className=\"btn btn-success font-weight-bold\" onClick={this.checkValidation}>\r\n            go to studio!\r\n          </button>\r\n        </div>\r\n\r\n      </div>\r\n\r\n      <footer className=\"p-2 w-100 d-flex justify-content-center\">\r\n        <a href=\"https://github.com/hamidb80/subtitle-editor/\" target=\"blank\"\r\n          className=\"d-flex align-items-center\">\r\n          <span className=\"fab fa-github github-logo\"></span>\r\n          <span className=\"pb-1 mx-2\"> project link on github </span>\r\n        </a>\r\n      </footer>\r\n    </>)\r\n  }\r\n}\r\n","export function getQueryParams() {\r\n  return Object.fromEntries(\r\n    new URLSearchParams(\r\n      window.location.search).entries())\r\n}\r\n","export const simpleSort = (a: any, b: any) => a > b ? 1 : -1","import React, { ChangeEvent } from 'react'\r\nimport hotkeys from 'hotkeys-js'\r\n\r\nimport { TimeControll } from \".\"\r\nimport { CircleBtn } from \"../form\"\r\nimport { Caption, areSameCaptions } from \"../../utils/caption\"\r\nimport { v4 as uuid } from \"uuid\"\r\n\r\nimport { SHOOT_SUBTITLE_TIME_MAJOR } from \"../../utils/consts\"\r\n\r\nimport './caption-editor.sass'\r\n\r\n\r\nexport default class CaptionEditor extends React.Component<{\r\n  currentTime: number // for stick time button\r\n  totalTime: number // video duration\r\n\r\n  caption: Caption | null\r\n  captionIndex: number\r\n  onCaptionChanged: (index: number, cNew: Caption) => void\r\n}, {\r\n  lastCaption: Caption | null, // a copy of props.caption to edit\r\n  newCaption: Caption | null,\r\n\r\n  is_ltr: boolean\r\n}>\r\n{\r\n  inputRef: React.RefObject<HTMLInputElement>\r\n\r\n  constructor(props: any) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      lastCaption: null,\r\n      newCaption: null,\r\n\r\n      is_ltr: true\r\n    }\r\n    this.inputRef = React.createRef()\r\n\r\n    // --- binding methods ---\r\n    this.onCaptionContentChanged = this.onCaptionContentChanged.bind(this)\r\n    this.onCaptionTimeRangeChanged = this.onCaptionTimeRangeChanged.bind(this)\r\n    this.handleCaptionChange = this.handleCaptionChange.bind(this)\r\n    this.isCapInTimeRange = this.isCapInTimeRange.bind(this)\r\n  }\r\n\r\n  // ------------------- component API -------------------------\r\n\r\n  componentDidMount() {\r\n    hotkeys('alt+left', () => {\r\n      this.onCaptionTimeRangeChanged(-SHOOT_SUBTITLE_TIME_MAJOR, 0)\r\n    })\r\n\r\n    hotkeys('ctrl+8', kv => {\r\n      kv.preventDefault()\r\n      this.onCaptionTimeRangeChanged(null, 0)\r\n    })\r\n    hotkeys('ctrl+9', kv => {\r\n      kv.preventDefault()\r\n      this.onCaptionTimeRangeChanged(0, null)\r\n    })\r\n\r\n    hotkeys('ctrl+0', kv => {\r\n      kv.preventDefault()\r\n      this.setState({ is_ltr: !this.state.is_ltr })\r\n    })\r\n    \r\n    hotkeys('enter', kv => {\r\n      this.onCaptionContentChanged(kv)\r\n      this.handleCaptionChange()\r\n    })\r\n\r\n    hotkeys('alt+right', () => {\r\n      this.onCaptionTimeRangeChanged(+SHOOT_SUBTITLE_TIME_MAJOR, 0)\r\n    })\r\n    hotkeys('tab+left', kv => {\r\n      kv.preventDefault()\r\n      this.onCaptionTimeRangeChanged(0, -SHOOT_SUBTITLE_TIME_MAJOR)\r\n    })\r\n    hotkeys('tab+right', kv => {\r\n      kv.preventDefault()\r\n      this.onCaptionTimeRangeChanged(0, +SHOOT_SUBTITLE_TIME_MAJOR)\r\n    })\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    if (\r\n      (!this.props.caption && this.state.lastCaption) ||\r\n      (this.props.caption && (this.props.caption.hash !== this.state.lastCaption?.hash))\r\n    ) {\r\n      this.handleCaptionChange() // onblur is not triggered when you blur it by code, so this line solves the problem\r\n\r\n      const newPropCap = this.props.caption === null ? null : { ...this.props.caption }\r\n      this.setState({\r\n        lastCaption: newPropCap ? { ...newPropCap } : null,\r\n        newCaption: newPropCap ? { ...newPropCap } : null\r\n      })\r\n    }\r\n  }\r\n\r\n  // ------------------- functionalities -------------------------\r\n\r\n  isCapInTimeRange(time: number): boolean {\r\n    return time >= 0 && time <= this.props.totalTime\r\n  }\r\n\r\n  onCaptionContentChanged(e: any) {\r\n    const newCap = this.state.newCaption\r\n    if (newCap !== null)\r\n      this.setState({\r\n        newCaption: { ...newCap, content: this.inputRef.current?.value || \"\" }\r\n      })\r\n  }\r\n  onCaptionTimeRangeChanged(startChange: number | null = 0, endChange: number | null = 0) { // null is the value for stick time button\r\n    const cap = this.state.newCaption\r\n    if (cap === null) return\r\n\r\n    // controll the caption start/end time \r\n    if (startChange === null)\r\n      cap.start = this.props.currentTime + 0.001\r\n    else if (this.isCapInTimeRange(cap.start + startChange))\r\n      cap.start += startChange\r\n\r\n    if (endChange === null)\r\n      cap.end = this.props.currentTime\r\n    else if (this.isCapInTimeRange(cap.end + endChange))\r\n      cap.end += endChange\r\n\r\n    // sync end & start\r\n    if (cap.start > cap.end) {\r\n      if (endChange === 0)\r\n        cap.end = cap.start\r\n      else\r\n        cap.start = cap.end\r\n    }\r\n\r\n    this.setState(\r\n      { newCaption: cap },\r\n      this.handleCaptionChange)\r\n\r\n  }\r\n\r\n  handleCaptionChange() {\r\n    if (this.state.lastCaption === null || this.state.newCaption === null) return\r\n\r\n    if (!areSameCaptions(this.state.lastCaption, this.state.newCaption)) {\r\n      const\r\n        lastCaption = this.state.lastCaption,\r\n        newCap = { ...this.state.newCaption, hash: uuid() }\r\n\r\n      this.setState({\r\n        lastCaption: { ...newCap },\r\n        newCaption: { ...newCap }\r\n      }, () => this.props.onCaptionChanged(this.props.captionIndex, newCap))\r\n    }\r\n  }\r\n\r\n  render() {\r\n    const cap = this.props.caption // myabe it's not available [for eg it can be removed]\r\n    if (cap)\r\n      this.inputRef.current?.focus()\r\n    else\r\n      this.inputRef.current?.blur()\r\n\r\n    return (\r\n      <div className=\"caption-editor-wrapper\">\r\n        {cap ?\r\n          <TimeControll\r\n            time={cap.start}\r\n            onChange={changeValue => { this.onCaptionTimeRangeChanged(changeValue, 0) }}\r\n          /> :\r\n          <TimeControll time={0} />\r\n        }\r\n\r\n        <div>\r\n          <CircleBtn\r\n            disabled={cap === null}\r\n            onClick={() => this.setState(ls => ({ is_ltr: !ls.is_ltr }))}\r\n            iconClassName={\"fas fa-align-\" + (this.state.is_ltr ? \"left\" : \"right\")}\r\n          />\r\n          <input type=\"text\" ref={this.inputRef} disabled={cap === null}\r\n            className={\"form-control caption-editor \" + (this.state.is_ltr ? \"ltr\" : \"rtl\")}\r\n            value={this.state.newCaption?.content || \"\"}\r\n            onChange={this.onCaptionContentChanged}\r\n            onBlur={this.handleCaptionChange} />\r\n        </div>\r\n\r\n        {cap ?\r\n          <TimeControll\r\n            time={cap.end}\r\n            onChange={changeValue => { this.onCaptionTimeRangeChanged(0, changeValue) }}\r\n          /> :\r\n          <TimeControll time={0} />\r\n        }\r\n      </div>\r\n    )\r\n  }\r\n}","import React from 'react'\r\nimport { Caption } from \"../../utils/caption\"\r\nimport './caption-view.sass'\r\n\r\ntype Props = {\r\n  currentTime: number\r\n  captions: Caption[]\r\n}\r\nexport default class CaptionView extends React.Component<Props> {\r\n  constructor(props: any) {\r\n    super(props)\r\n    \r\n    this.getCaptionContent = this.getCaptionContent.bind(this)\r\n  }\r\n\r\n  getCaptionContent(): string {\r\n    const\r\n      t = this.props.currentTime,\r\n      cap = this.props.captions.find((c: Caption) => t >= c.start && t <= c.end)\r\n\r\n    return cap ? cap.content : \"\"\r\n  }\r\n\r\n  render() {\r\n    const content = this.getCaptionContent()\r\n\r\n    return (\r\n      <div className=\"caption-group\">\r\n        {content === \"\" ? '' :\r\n          <div className=\"caption\">\r\n            {content}\r\n          </div>\r\n        }\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\n","import React, { MouseEvent } from 'react'\r\nimport { second2timestamp } from \"../../utils/timestamp\"\r\n\r\nimport './simple-timeline.sass'\r\n\r\ntype Props = {\r\n  className?: string\r\n\r\n  totalTime: number // per seconds\r\n  currentTime: number\r\n  onSelectNewTime?: (newTime: number) => void\r\n}\r\nexport default class SimpleTimeline extends React.Component<Props> {\r\n  constructor(props: any) {\r\n    super(props)\r\n\r\n    this.handleClick = this.handleClick.bind(this)\r\n  }\r\n\r\n  handleClick(e: MouseEvent<HTMLDivElement>) {\r\n    const handler = this.props.onSelectNewTime\r\n\r\n    if (handler) {\r\n      const element = e.currentTarget\r\n        , xUserClicked = e.pageX\r\n        , xFirstOfProgressBar = element.offsetLeft\r\n        , width = element.clientWidth\r\n        , videoDuration = this.props.totalTime\r\n\r\n      const newTime = ((xUserClicked - xFirstOfProgressBar) / width) * videoDuration\r\n\r\n      handler(newTime)\r\n    }\r\n  }\r\n\r\n  render() {\r\n    if (this.props.totalTime === undefined)\r\n      return ''\r\n\r\n    const\r\n      widthPercent = this.props.currentTime / this.props.totalTime * 100,\r\n      time = second2timestamp(this.props.currentTime, \"minute\"),\r\n      duration = second2timestamp(this.props.totalTime, \"minute\")\r\n\r\n    return (\r\n      <div className={\"timeline \" + this.props.className}\r\n        onClick={this.handleClick}>\r\n        \r\n        <div className=\"progress\">\r\n          <div className=\"progress-bar\" style={{ width: `${widthPercent}%` }}></div>\r\n          <div className=\"cursor\"></div>\r\n        </div>\r\n\r\n        <div className=\"time-text-wrapper\">\r\n          <div className=\"time-text\">\r\n            <span> {time} </span>\r\n            <span> - </span>\r\n            <span> {duration} </span>\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n    )\r\n  }\r\n}","import React, { SyntheticEvent, MouseEvent } from 'react'\r\n\r\nimport \"./video-player.sass\"\r\n\r\nconst videoControllHiddingDelay = 2\r\n\r\n\r\ntype Props = {\r\n  videoUrl: string\r\n  onTimeUpdate?: (timePerSecond: number) => void\r\n  onError?: (e: SyntheticEvent) => void\r\n  onDurationChanges: (duration: number) => void\r\n  height?: number\r\n}\r\nexport default class VideoPlayer extends React.Component<Props> {\r\n  videoElementRef: React.RefObject<HTMLVideoElement>\r\n  timer: number = 0 // for settimeout\r\n\r\n  state: {\r\n    lastStart: number\r\n    showVideoControll: boolean\r\n  }\r\n\r\n  constructor(props: any) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      lastStart: 0,\r\n      showVideoControll: false\r\n    }\r\n\r\n    this.videoElementRef = React.createRef()\r\n\r\n    // --- register methods ---\r\n    // events\r\n    this.onTimeUpdate = this.onTimeUpdate.bind(this)\r\n    this.onMouseMove = this.onMouseMove.bind(this)\r\n    this.onError = this.onError.bind(this)\r\n\r\n    // actions\r\n    this.setPlay = this.setPlay.bind(this)\r\n    this.isPlaying = this.isPlaying.bind(this)\r\n    this.disableVideoControllers = this.disableVideoControllers.bind(this)\r\n\r\n    this.onDurationChanges = this.onDurationChanges.bind(this)\r\n  }\r\n\r\n  // ----------------------- events ------------------------\r\n\r\n  onDurationChanges() {\r\n    // emit signal\r\n    if (this.props.onDurationChanges) {\r\n      const du = this.videoElementRef.current?.duration || 0\r\n      this.props.onDurationChanges(du)\r\n    }\r\n  }\r\n\r\n  onTimeUpdate(e: SyntheticEvent<HTMLVideoElement, Event>) {\r\n    if (this.props.onTimeUpdate) {\r\n      const currentTime = e.currentTarget.currentTime\r\n      this.props.onTimeUpdate(currentTime)\r\n    }\r\n  }\r\n\r\n  onMouseMove(e: MouseEvent) {\r\n    if (this.timer)\r\n      clearTimeout(this.timer)\r\n\r\n    this.setState({ showVideoControll: true })\r\n    this.timer = +setTimeout(this.disableVideoControllers, videoControllHiddingDelay * 1000)\r\n  }\r\n\r\n  onError(e: SyntheticEvent) {\r\n    if (this.props.onError)\r\n      this.props.onError(e)\r\n  }\r\n\r\n  // // ----------------------- functions ------------------------\r\n\r\n  disableVideoControllers() {\r\n    clearTimeout(this.timer)\r\n    this.setState({ showVideoControll: false })\r\n  }\r\n\r\n  setTime(timePerSeconds: number) {\r\n    const ve = this.videoElementRef.current\r\n    if (ve) ve.currentTime = timePerSeconds\r\n  }\r\n\r\n  shootTime(seconds: number) {\r\n    const ve = this.videoElementRef.current\r\n\r\n    if (ve) {\r\n      const currentTime = ve.currentTime\r\n      this.setTime(currentTime + seconds)\r\n    }\r\n  }\r\n\r\n  setPlay(play: boolean) {\r\n    if (this.videoElementRef.current) {\r\n      if (play)\r\n        this.videoElementRef.current?.play()\r\n      else\r\n        this.videoElementRef.current?.pause()\r\n    }\r\n  }\r\n\r\n  togglePlay() {\r\n    this.setPlay(!this.isPlaying())\r\n  }\r\n\r\n  isPlaying(): boolean {\r\n    return Boolean(this.videoElementRef.current && !this.videoElementRef.current.paused)\r\n  }\r\n\r\n  // -------------------------- component API ---------------------------\r\n  render() {\r\n    const isPlaying = this.isPlaying()\r\n\r\n    return (\r\n      <div className={\"video-player \" + (this.state.showVideoControll ? 'show ' : '')}\r\n        onMouseMove={this.onMouseMove} onMouseOut={this.disableVideoControllers}>\r\n\r\n        <div className=\"video-screen\" onContextMenu={e => e.preventDefault()}>\r\n\r\n          <video\r\n            height={this.props.height}\r\n            onTimeUpdate={this.onTimeUpdate}\r\n            ref={this.videoElementRef}\r\n            src={this.props.videoUrl}\r\n            autoPlay={false}\r\n            loop={false}\r\n            onDurationChange={this.onDurationChanges}\r\n            onError={e => this.onError(e)}\r\n          ></video>\r\n\r\n          <div className=\"video-state-controller\">\r\n            <div className=\"part\"></div>\r\n\r\n            <div className=\"part action-btn-group\">\r\n              <div className=\"action-btn play-pause\" onClick={() => this.setPlay(!isPlaying)}>\r\n                <span className={\"icon fas fa-3x \" + (isPlaying ? \"fa-pause\" : \"fa-play\")}>\r\n                </span>\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"part\"></div>\r\n          </div>\r\n\r\n        </div>\r\n      </div >\r\n    )\r\n  }\r\n}","import React, { MouseEvent } from 'react'\r\nimport Draggable, { DraggableData, DraggableEvent } from 'react-draggable'\r\nimport hotkeys from 'hotkeys-js'\r\n\r\nimport { CircleBtn } from \"../form\"\r\nimport { Caption } from \"../../utils/caption\"\r\nimport { second2timestamp } from \"../../utils/timestamp\"\r\nimport Konva from \"konva\"\r\n\r\nimport {\r\n  MAX_SCALE, DEFAULT_SCALE, SHOOT_ZOOM, TIMELINE_CURSOR_OFFSET, MAX_CANVAS_SIZE\r\n} from \"../../utils/consts\"\r\n\r\nimport \"./subtitle-timeline.sass\"\r\n\r\nconst out = -10\r\n\r\nexport default class SubtitleTimeline extends React.Component<{\r\n  className?: string\r\n\r\n  duration: number\r\n  currentTime: number\r\n  onSelectNewTime: (newTime: number) => void\r\n\r\n  captions: Caption[]\r\n  selectedCaption_i: number | null\r\n  onCaptionSelected: (captionIndex: number | null) => void\r\n  onCaptionChanged: (captionIndex: number, captionItem: Caption) => void\r\n},\r\n  {\r\n    error: boolean\r\n    lastScale: number\r\n    scale: number\r\n    timeRulers: string[]\r\n    cursorXPos: number\r\n  }\r\n> {\r\n  canvasRef: React.RefObject<HTMLDivElement>\r\n  group: Konva.Group | null\r\n\r\n  constructor(props: any) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      error: false,\r\n      lastScale: 0,\r\n      scale: 0,\r\n      cursorXPos: out,\r\n      timeRulers: [], // array of dataUrl\r\n    }\r\n\r\n    this.canvasRef = React.createRef()\r\n    this.group = null\r\n\r\n    // --- method binding ---\r\n    this.captionSelectionHandler = this.captionSelectionHandler.bind(this)\r\n\r\n    this.initTimeRuler = this.initTimeRuler.bind(this)\r\n    this.updateRuler = this.updateRuler.bind(this)\r\n    this.setTimeFromPixels = this.setTimeFromPixels.bind(this)\r\n\r\n    this.zoom = this.zoom.bind(this)\r\n    this.zoomIn = this.zoomIn.bind(this)\r\n    this.zoomOut = this.zoomOut.bind(this)\r\n    this.isZoomInValid = this.isZoomInValid.bind(this)\r\n    this.isZoomOutValid = this.isZoomOutValid.bind(this)\r\n\r\n    this.calculateRealOffset = this.calculateRealOffset.bind(this)\r\n  }\r\n\r\n  // --------------------------- methods ---------------------\r\n  captionSelectionHandler(index: number) {\r\n    this.props.onCaptionSelected(index)\r\n  }\r\n\r\n  zoom(value: number) {\r\n    const new_val = this.state.scale + value\r\n\r\n    if (this.isZoomInValid(new_val) && this.isZoomOutValid(new_val))\r\n      this.setState({ scale: new_val })\r\n  }\r\n  isZoomInValid(val: number): boolean {\r\n    return (val <= MAX_SCALE)\r\n  }\r\n  isZoomOutValid(val: number) {\r\n    return val > 0\r\n  }\r\n  zoomIn() {\r\n    this.zoom(+SHOOT_ZOOM)\r\n  }\r\n  zoomOut() {\r\n    this.zoom(-SHOOT_ZOOM)\r\n  }\r\n\r\n  calculateRealOffset(e: MouseEvent) {\r\n    const mouseX = e.pageX, // based on the screen\r\n      PostionOfElem = e.currentTarget.getBoundingClientRect()\r\n\r\n    return mouseX - PostionOfElem.left\r\n  }\r\n\r\n  setTimeFromPixels(timePerPixels: number) {\r\n    this.props.onSelectNewTime(this.props.currentTime - TIMELINE_CURSOR_OFFSET + timePerPixels / this.state.scale)\r\n  }\r\n\r\n  initTimeRuler() {\r\n    let\r\n      stage = new Konva.Stage({\r\n        container: this.canvasRef.current as HTMLDivElement,\r\n        width: window.innerWidth,\r\n        height: 32,\r\n      }),\r\n      layer = new Konva.Layer()\r\n\r\n    this.group = new Konva.Group()\r\n    layer.add(this.group)\r\n    stage.add(layer)\r\n\r\n    this.updateRuler()\r\n  }\r\n\r\n  updateRuler() {\r\n    let\r\n      cachedTimeRulers: string[] = [],\r\n      s = this.state.scale,\r\n      maximumSecondsPerChunk = Math.floor(MAX_CANVAS_SIZE / s),\r\n      d = this.props.duration,\r\n      progress = 0\r\n\r\n    while (progress < d) {\r\n      let limit = Math.min(d, progress + maximumSecondsPerChunk)\r\n\r\n      for (let second = progress; second <= limit; second++) {\r\n        const\r\n          time = second2timestamp(second, \"minute\"),\r\n          common = { text: time, x: this.state.scale * second - 14, y: 4, fontSize: 13, fontFamily: \"tahoma\" }\r\n\r\n        if (s < 20) {\r\n          if (second % 5 === 0)\r\n            this.group?.add(new Konva.Text(common))\r\n        }\r\n        else if (s < 30) {\r\n          if (second % 3 === 0)\r\n            this.group?.add(new Konva.Text(common))\r\n        }\r\n        else if (s < 40) {\r\n          if (second % 2 === 0)\r\n            this.group?.add(new Konva.Text(common))\r\n        }\r\n        else {\r\n          this.group?.add(new Konva.Text(common))\r\n        }\r\n\r\n        this.group?.add(new Konva.Rect({ x: s * second, y: 22, width: 2, height: 10, fill: \"black\" }))\r\n      }\r\n\r\n      cachedTimeRulers.push(this.group?.toDataURL() as string)\r\n      this.group?.destroyChildren()\r\n      progress = limit\r\n    }\r\n\r\n    this.setState({ timeRulers: cachedTimeRulers })\r\n  }\r\n\r\n  //  ------------------- component API ----------------------\r\n  componentDidMount() {\r\n    // --- register shortcuts\r\n    hotkeys('ctrl+=', kv => {\r\n      kv.preventDefault()\r\n      this.zoomIn()\r\n    })\r\n    hotkeys('ctrl+-', kv => {\r\n      kv.preventDefault()\r\n      this.zoomOut()\r\n    })\r\n  }\r\n\r\n  componentDidUpdate() {\r\n    if (this.props.duration === 0) return\r\n\r\n    if (this.state.scale === 0) {\r\n      let currentScale = DEFAULT_SCALE\r\n\r\n      if (currentScale <= 0)\r\n        this.setState({ error: true, scale: -1 })\r\n      else\r\n        this.setState({ scale: currentScale })\r\n    }\r\n\r\n    // to prevent useless rerender\r\n    else if (this.state.lastScale !== this.state.scale) {\r\n      this.setState({ lastScale: this.state.scale }, this.updateRuler)\r\n    }\r\n\r\n    if (this.group === null)\r\n      this.initTimeRuler()\r\n  }\r\n\r\n  render() {\r\n    if (this.state.error)\r\n      return <div className=\"center badge-danger\"> an error acuured </div>\r\n\r\n    const\r\n      duration = this.props.duration,\r\n      progress = -(this.props.currentTime - TIMELINE_CURSOR_OFFSET) / duration * 100,\r\n      scale = this.state.scale\r\n\r\n    return (\r\n      <div className={\"advanced-timeline \" + this.props.className}>\r\n\r\n        <div className=\"side-bar\">\r\n          <CircleBtn\r\n            className=\"mb-1\"\r\n            onClick={this.zoomIn}\r\n            disabled={!this.isZoomInValid(this.state.scale + SHOOT_ZOOM)}\r\n            iconClassName=\"fas fa-search-plus\"\r\n          />\r\n\r\n          <div className=\"center scale-text\">\r\n            {scale}\r\n          </div>\r\n\r\n          <CircleBtn\r\n            className=\"mb-1\"\r\n            onClick={this.zoomOut}\r\n            disabled={!this.isZoomOutValid(this.state.scale - SHOOT_ZOOM)}\r\n            iconClassName=\"fas fa-search-minus\"\r\n          />\r\n        </div>\r\n\r\n        <div className=\"advanced-timeline-wrapper\">\r\n\r\n          <div className=\"current-time-cursor\" style={{\r\n            marginLeft: `${TIMELINE_CURSOR_OFFSET * scale}px`,\r\n          }}></div>\r\n\r\n          <div className=\"mover\"\r\n            onMouseMove={e => this.setState({ cursorXPos: this.calculateRealOffset(e) })}\r\n            onMouseLeave={() => this.setState({ cursorXPos: out })}\r\n          >\r\n\r\n            <div className=\"konva-instance\" ref={this.canvasRef}></div>\r\n\r\n            <div className=\"time-cursor-wrapper\">\r\n              <UserCursorElem\r\n                posx={this.state.cursorXPos}\r\n                onclick={(e: MouseEvent) => this.setTimeFromPixels(this.calculateRealOffset(e))} />\r\n            </div>\r\n\r\n            <div className=\"inside-timeline\" style={{\r\n              transform: `translateX(${progress}%)`,\r\n              width: `${duration * scale}px`,\r\n              transition: \"0.1s linear\"\r\n            }}>\r\n\r\n              <div className=\"times\" >\r\n                {this.state.timeRulers.map((dataUrl, i) =>\r\n                  <img src={dataUrl} alt={`time-ruler-{i}`} />\r\n                )}\r\n              </div>\r\n\r\n              <div className=\"captions-side\">\r\n                {this.props.captions.map((c: Caption, i) =>\r\n                  <CaptionItem\r\n                    cap={c}\r\n                    index={i}\r\n                    selected_i={this.props.selectedCaption_i ?? -1}\r\n                    clickFunc={this.captionSelectionHandler}\r\n                    onCaptionChanged={this.props.onCaptionChanged}\r\n                    scale={scale}\r\n                  />\r\n                )\r\n                }\r\n              </div>\r\n            </div>\r\n\r\n          </div>\r\n        </div>\r\n\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nclass CaptionItem extends React.Component<{\r\n  cap: Caption\r\n  index: number\r\n  selected_i: number\r\n  clickFunc: (index: number) => void\r\n  onCaptionChanged: (captionIndex: number, captionItem: Caption) => void\r\n  scale: number\r\n}, {\r\n  cachedCap: Caption\r\n}>{\r\n  constructor(props: any) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      cachedCap: props.cap\r\n    }\r\n\r\n    this.onClick = this.onClick.bind(this)\r\n    this.onDragCenterStop = this.onDragCenterStop.bind(this)\r\n    this.onDragHeadStop = this.onDragHeadStop.bind(this)\r\n    this.onDragTailStop = this.onDragTailStop.bind(this)\r\n  }\r\n\r\n  onDragCenterStop(e: DraggableEvent, dd: DraggableData) {\r\n    if (this.props.selected_i !== this.props.index) return\r\n\r\n    let\r\n      c = this.props.cap,\r\n      s = this.props.scale,\r\n      u = {\r\n        ...c,\r\n        start: c.start + dd.lastX / s,\r\n        end: c.end + dd.lastX / s,\r\n      }\r\n\r\n    this.props.onCaptionChanged(this.props.selected_i, u)\r\n  }\r\n\r\n  onDragHeadStop(e: DraggableEvent, dd: DraggableData) {\r\n    if (this.props.selected_i !== this.props.index) return\r\n\r\n    let\r\n      c = this.props.cap,\r\n      s = this.props.scale,\r\n      u = {\r\n        ...c,\r\n        start: c.start + dd.lastX / s,\r\n      }\r\n\r\n    this.props.onCaptionChanged(this.props.selected_i, u)\r\n  }\r\n\r\n  onDragTailStop(e: DraggableEvent, dd: DraggableData) {\r\n    if (this.props.selected_i !== this.props.index) return\r\n\r\n    let\r\n      c = this.props.cap,\r\n      s = this.props.scale,\r\n      u = {\r\n        ...c,\r\n        end: c.end + dd.lastX / s,\r\n      }\r\n\r\n    this.props.onCaptionChanged(this.props.selected_i, u)\r\n  }\r\n\r\n  onClick(e: MouseEvent) {\r\n    this.props.clickFunc(this.props.index)\r\n  }\r\n\r\n  render() {\r\n    let\r\n      c = this.props.cap,\r\n      width = c.end - c.start,\r\n      isSelected = this.props.selected_i === this.props.index\r\n\r\n    return (\r\n      <div className={\"caption-item \" + (isSelected ? 'selected' : '')}\r\n        key={c.hash} onClick={this.onClick}\r\n        style={{\r\n          left: `${c.start * this.props.scale}px`,\r\n          width: `${width * this.props.scale}px`\r\n        }}>\r\n\r\n        <div className=\"start-pad\">\r\n          <Draggable\r\n            axis={isSelected ? \"x\" : \"none\"}\r\n            position={{ x: 0, y: 0 }}\r\n            onStop={this.onDragHeadStop}\r\n          >\r\n            <div className=\"inside\"></div>\r\n          </Draggable>\r\n        </div>\r\n\r\n        <div className=\"content\">\r\n\r\n          <Draggable\r\n            axis={isSelected ? \"x\" : \"none\"}\r\n            position={{ x: 0, y: 0 }}\r\n            onStop={this.onDragCenterStop}\r\n          >\r\n            <div className=\"slide\"></div>\r\n          </Draggable>\r\n          <span>{c.content}</span>\r\n        </div>\r\n\r\n        <div className=\"end-pad\">\r\n          <Draggable\r\n            axis={isSelected ? \"x\" : \"none\"}\r\n            position={{ x: 0, y: 0 }}\r\n            onStop={this.onDragTailStop}\r\n          >\r\n            <div className=\"inside\"></div>\r\n          </Draggable>\r\n        </div>\r\n\r\n      </div >\r\n    )\r\n  }\r\n}\r\n\r\nclass UserCursorElem extends React.Component<{\r\n  onclick: (e: MouseEvent) => void\r\n  posx: number\r\n}>\r\n{\r\n  render() {\r\n    return (\r\n      <div className=\"user-time-cursor-wrapper\"\r\n        onClick={this.props.onclick} >\r\n        <div className=\"user-time-cursor\"\r\n          style={{ transform: `translateX(${this.props.posx}px)` }}></div>\r\n      </div>\r\n    )\r\n  }\r\n}","export const\r\n  MAX_HISTORY = 50,\r\n  SHOOT_TIME_MAJOR = 5,\r\n  SHOOT_TIME_MINOR = 0.5,\r\n\r\n  SHOOT_SUBTITLE_TIME_MAJOR = 0.5,\r\n  SHOOT_SUBTITLE_TIME_MINOR = 0.1,\r\n\r\n  ADD_CAPTION_TIME = 0.3,\r\n  \r\n  TIMELINE_CURSOR_OFFSET = 4, // per seconds\r\n  \r\n  SHOOT_ZOOM  = 10,\r\n  DEFAULT_SCALE = 30,\r\n  MAX_SCALE = 100,\r\n\r\n  MAX_CANVAS_SIZE = 32_000 // it's actually 32,767 but I prefer not to go around the limit\r\n\r\n","import React, { ChangeEvent, FocusEvent } from 'react'\r\nimport { second2timestamp, timestamp2seconds } from \"../../utils/timestamp\"\r\n\r\nimport { CircleBtn } from \"../form\"\r\nimport { SHOOT_SUBTITLE_TIME_MAJOR, SHOOT_SUBTITLE_TIME_MINOR } from \"../../utils/consts\";\r\n\r\nimport './time-controll.sass'\r\n\r\ntype Props = {\r\n  time: number // per seconds\r\n  onChange?: (changedValue: number | null) => void\r\n}\r\ntype State = {\r\n  isEditing: boolean\r\n  timeEditing: string\r\n}\r\nexport default class TimeControll extends React.Component<Props, State> {\r\n  constructor(props: any) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      isEditing: false,\r\n      timeEditing: ''\r\n    }\r\n\r\n    this.changeHandler = this.changeHandler.bind(this)\r\n    this.changeTimeEditing = this.changeTimeEditing.bind(this)\r\n    this.textEditorTimeChange = this.textEditorTimeChange.bind(this)\r\n  }\r\n\r\n  changeEditingState(val: boolean) {\r\n    if (this.props.onChange)\r\n      this.setState({\r\n        isEditing: val,\r\n        timeEditing: val ? second2timestamp(this.props.time, \"complete\") : ''\r\n      })\r\n  }\r\n\r\n  textEditorTimeChange(e: FocusEvent<HTMLInputElement>) {\r\n    const newTimeString = e.target.value\r\n    let newTime: number\r\n\r\n\r\n    try { newTime = timestamp2seconds(newTimeString) }\r\n    catch (error) { return }\r\n\r\n    const delataTime = newTime - this.props.time\r\n\r\n    this.changeHandler(delataTime)\r\n    this.changeEditingState(false)\r\n  }\r\n\r\n  changeTimeEditing(e: ChangeEvent<HTMLInputElement>) {\r\n    this.setState({ timeEditing: e.target.value })\r\n  }\r\n\r\n  changeHandler(changedValue: number | null) {\r\n    if (this.props.onChange)\r\n      this.props.onChange(changedValue)\r\n  }\r\n\r\n  render() {\r\n    const\r\n      disabled = this.props.onChange === undefined,\r\n      time = second2timestamp(this.props.time, \"complete\"),\r\n\r\n      timeElem = this.state.isEditing ?\r\n        (<div className=\"time-editor\">\r\n          <input type=\"text\" className=\"time-text-editor\"\r\n            onChange={this.changeTimeEditing} value={this.state.timeEditing}\r\n            autoFocus onBlur={this.textEditorTimeChange} />\r\n        </div>\r\n        ) : (\r\n          <div className=\"time-text\" onDoubleClick={() => this.changeEditingState(true)}>\r\n            <span> {time} </span>\r\n          </div>\r\n        )\r\n\r\n    return (\r\n      <div className=\"time-control-wrapper\">\r\n        <CircleBtn\r\n          className=\"time-control-btn minus-time\"\r\n          disabled={disabled}\r\n          iconClassName=\"fas fa-minus\"\r\n          onClick={() => this.changeHandler(-SHOOT_SUBTITLE_TIME_MAJOR)}\r\n        />\r\n\r\n        <CircleBtn\r\n          className=\"time-control-btn minus-time little\"\r\n          disabled={disabled}\r\n          onClick={() => this.changeHandler(-SHOOT_SUBTITLE_TIME_MINOR)}\r\n          iconClassName=\"fas fa-minus\"\r\n        />\r\n\r\n        {timeElem}\r\n\r\n        <CircleBtn\r\n          className=\"time-control-btn add-time little\"\r\n          disabled={disabled}\r\n\r\n          onClick={() => this.changeHandler(+SHOOT_SUBTITLE_TIME_MINOR)}\r\n          iconClassName=\"fas fa-plus\"\r\n        />\r\n\r\n        <CircleBtn\r\n          className=\"time-control-btn add-time\"\r\n          disabled={disabled}\r\n          onClick={() => this.changeHandler(+SHOOT_SUBTITLE_TIME_MAJOR)}\r\n          iconClassName=\"fas fa-plus\"\r\n        />\r\n\r\n        <CircleBtn\r\n          className=\"time-control-btn add-time\"\r\n          disabled={disabled}\r\n          onClick={() => this.changeHandler(null)}\r\n          iconClassName=\"fas fa-angle-double-up\"\r\n        />\r\n      </div>\r\n    )\r\n  }\r\n}\r\n","import React, { SyntheticEvent } from 'react'\r\nimport Draggable, { DraggableData, DraggableEvent } from 'react-draggable'\r\nimport hotkeys from 'hotkeys-js'\r\nimport { v4 as uuid } from \"uuid\"\r\n\r\nimport appStates from \"../utils/states\"\r\nimport { simpleSort } from \"../utils/funcs\"\r\nimport { Caption, export2srt, captionsCompare } from \"../utils/caption\"\r\nimport { SHOOT_TIME_MINOR, SHOOT_TIME_MAJOR, MAX_HISTORY } from \"../utils/consts\"\r\n\r\nimport { VideoPlayer, Timeline, SubtitleTimeline, CaptionEditor, CaptionView } from \"../components/video\"\r\nimport { CircleBtn, pushToast } from \"../components/form\"\r\n\r\nimport \"./studio.sass\"\r\nconst fileDownload = require('js-file-download')\r\n\r\n\r\nfunction copyReplace<T>(arr: T[], i: number, repl: T): T[] {\r\n  return Object.assign([], arr, { [i]: repl })\r\n}\r\n\r\nexport default class Studio extends React.Component<{}, {\r\n  videoUrl: string\r\n  videoHeight: number\r\n  acc: number\r\n  \r\n  subFileName: string\r\n\r\n  currentTime: number\r\n  totalTime: number\r\n\r\n  captions: Caption[]\r\n  selected_caption_i: number | null\r\n  \r\n  history: Caption[][]\r\n  historyCursor: number\r\n}> {\r\n\r\n  VideoPlayerRef: React.RefObject<VideoPlayer>\r\n\r\n  constructor(props: any) {\r\n    super(props)\r\n\r\n    this.state = {\r\n      videoUrl: appStates.videoUrl.getData(),\r\n      videoHeight: 400,\r\n      acc: 0,\r\n\r\n      currentTime: 0,\r\n      totalTime: 0,\r\n\r\n      subFileName: \"subtitle.srt\",\r\n\r\n      captions: [],\r\n      selected_caption_i: null,\r\n\r\n      historyCursor: -1,\r\n      history: [],\r\n    }\r\n\r\n    this.VideoPlayerRef = React.createRef()\r\n\r\n    // --- bind methods ---\r\n    this.onTimeUpdate = this.onTimeUpdate.bind(this)\r\n    this.onVideoError = this.onVideoError.bind(this)\r\n    this.handleSeparatorDrag = this.handleSeparatorDrag.bind(this)\r\n    this.handleSeparatorStop = this.handleSeparatorStop.bind(this)\r\n\r\n    this.addCaptionUIHandler = this.addCaptionUIHandler.bind(this)\r\n    this.changeCaptionUIHandler = this.changeCaptionUIHandler.bind(this)\r\n    this.changeCaptionObject = this.changeCaptionObject.bind(this)\r\n    this.deleteCaptionUIHandler = this.deleteCaptionUIHandler.bind(this)\r\n    this.deleteCaptionObject = this.deleteCaptionObject.bind(this)\r\n    this.captionSelectionToggle = this.captionSelectionToggle.bind(this)\r\n\r\n    this.updatedHistory = this.updatedHistory.bind(this)\r\n    this.undoRedo = this.undoRedo.bind(this)\r\n\r\n    this.goToLastStart = this.goToLastStart.bind(this)\r\n    this.goToNextEnd = this.goToNextEnd.bind(this)\r\n\r\n    this.saveFile = this.saveFile.bind(this)\r\n  }\r\n\r\n  // ------------- component API -----------------\r\n\r\n  componentDidMount() {\r\n    // --- init states ---\r\n    const initCaps = appStates.subtitles.getData()\r\n    this.setState({\r\n      captions: initCaps,\r\n      ...this.updatedHistory(initCaps)\r\n    })\r\n\r\n    // --- bind shortcuts ---\r\n    hotkeys.filter = () => true // to make it work also in input elements\r\n\r\n    hotkeys('alt+*, tab, shift+tab', kv => kv.preventDefault())\r\n\r\n    hotkeys('ctrl+shift+left', kv => {\r\n      if (this.state.selected_caption_i === null) {\r\n        kv.preventDefault()\r\n        this.VideoPlayerRef.current?.shootTime(-SHOOT_TIME_MAJOR)\r\n      }\r\n    })\r\n    hotkeys('ctrl+shift+right', kv => {\r\n      if (this.state.selected_caption_i === null) {\r\n        kv.preventDefault()\r\n        this.VideoPlayerRef.current?.shootTime(+SHOOT_TIME_MAJOR)\r\n      }\r\n    })\r\n    hotkeys('ctrl+6', kv => {\r\n      kv.preventDefault()\r\n      this.goToLastStart()\r\n    })\r\n    hotkeys('ctrl+7', kv => {\r\n      kv.preventDefault()\r\n      this.goToNextEnd()\r\n    })\r\n    hotkeys('ctrl+left', kv => {\r\n      kv.preventDefault()\r\n      this.VideoPlayerRef.current?.shootTime(-SHOOT_TIME_MINOR)\r\n    })\r\n    hotkeys('ctrl+right', kv => {\r\n      kv.preventDefault()\r\n      this.VideoPlayerRef.current?.shootTime(+SHOOT_TIME_MINOR)\r\n    })\r\n\r\n    hotkeys('ctrl+enter', () => this.addCaptionUIHandler())\r\n\r\n    hotkeys('ctrl+down', kv => {\r\n      kv.preventDefault()\r\n\r\n      const t = this.state.currentTime,\r\n        i = this.state.captions.findIndex(c => t >= c.start && t <= c.end)\r\n\r\n      if (i !== -1)\r\n        this.setState({ selected_caption_i: i })\r\n    })\r\n    hotkeys('escape', kv => {\r\n      kv.preventDefault()\r\n      this.setState({ selected_caption_i: null })\r\n    })\r\n\r\n    hotkeys('space', kv => {\r\n      // @ts-ignore\r\n      if (kv.target.tagName !== 'INPUT')\r\n        kv.preventDefault()\r\n    })\r\n    hotkeys('ctrl+space', kv => {\r\n      this.VideoPlayerRef.current?.togglePlay()\r\n    })\r\n\r\n    hotkeys('ctrl+delete', () => this.deleteCaptionUIHandler())\r\n\r\n    hotkeys('ctrl+z', () => this.undoRedo(true))\r\n    hotkeys('ctrl+y', () => this.undoRedo(false))\r\n    hotkeys('ctrl+s', kv => {\r\n      kv.preventDefault()\r\n      this.saveFile()\r\n    })\r\n\r\n  }\r\n  componentWillUnmount() {\r\n    hotkeys.unbind()\r\n  }\r\n\r\n  // ----------- video player events -------------------\r\n\r\n  onTimeUpdate(nt: number) { // nt: new time\r\n    const sci = this.state.selected_caption_i\r\n    if (sci !== null) {\r\n      const cap = this.state.captions[sci],\r\n        ve = this.VideoPlayerRef,\r\n        isplying = ve.current?.isPlaying()\r\n\r\n      if (nt >= cap.end) {\r\n        if (isplying) {\r\n          ve.current?.setPlay(false)\r\n          ve.current?.setTime(cap.start)\r\n        }\r\n      }\r\n      else if (nt < cap.start) {\r\n        if (isplying)\r\n          ve.current?.setTime(cap.start)\r\n      }\r\n    }\r\n\r\n    this.setState({ currentTime: nt })\r\n  }\r\n\r\n  onVideoError(e: SyntheticEvent) {\r\n    pushToast({\r\n      kind: 'danger',\r\n      message: \"error happend while loading video\",\r\n      duration: 5000\r\n    })\r\n  }\r\n\r\n  // ----------------- functionalities --------------------\r\n  // -- captions changes\r\n\r\n  changeCaptionObject(index: number, newcap: Caption): Caption[] {\r\n    return copyReplace(\r\n      this.state.captions,\r\n      index,\r\n      { ...newcap, hash: uuid() })\r\n  }\r\n  deleteCaptionObject(selected_i: number): Caption[] {\r\n    let\r\n      copy = [...this.state.captions],\r\n      lastIndex = copy.length - 1\r\n\r\n    if (selected_i !== lastIndex)\r\n      copy[selected_i] = copy[lastIndex]\r\n\r\n    copy.pop()\r\n\r\n    return copy\r\n  }\r\n\r\n  addCaptionUIHandler() {\r\n    let\r\n      ct = this.state.currentTime,\r\n      currentCap = this.state.captions.find(c => (ct >= c.start) && (ct <= c.end)),\r\n      t = currentCap && (currentCap.end - ct < 0.6) ? currentCap.end + 0.001 : ct,\r\n      newCap = {\r\n        start: t,\r\n        end: t + 1,\r\n        content: \"New Caption\",\r\n        hash: uuid(),\r\n      },\r\n      caps = this.state.captions.concat(newCap)\r\n\r\n    this.setState({\r\n      captions: caps,\r\n      selected_caption_i: this.state.captions.length,\r\n      ...this.updatedHistory(caps),\r\n    })\r\n  }\r\n  changeCaptionUIHandler(index: number, newCap: Caption) {\r\n    if (index < 0 || index >= this.state.captions.length) return // it can happen due to fast repeative user actions\r\n\r\n    let caps = this.changeCaptionObject(index, newCap)\r\n\r\n    this.setState({\r\n      captions: caps,\r\n      ...this.updatedHistory(caps),\r\n    })\r\n  }\r\n  deleteCaptionUIHandler() {\r\n    if (this.state.selected_caption_i === null) return\r\n\r\n    let caps = this.deleteCaptionObject(this.state.selected_caption_i)\r\n\r\n    this.setState({\r\n      selected_caption_i: null,\r\n      captions: caps,\r\n      ...this.updatedHistory(caps),\r\n    })\r\n  }\r\n\r\n  updatedHistory(caps: Caption[]): object {\r\n    let\r\n      h = this.state.history,\r\n      li = h.length - 1, // last index\r\n      c = this.state.historyCursor\r\n\r\n    if (c < li)\r\n      h = [...h.slice(0, c + 1), caps]\r\n    else\r\n      h = [...h, caps]\r\n\r\n    h = h.slice(-MAX_HISTORY)\r\n\r\n    return {\r\n      historyCursor: h.length - 1,\r\n      history: h\r\n    }\r\n  }\r\n  undoRedo(undo: boolean) {\r\n    const\r\n      hc = this.state.historyCursor,\r\n      history = this.state.history,\r\n      dir = (undo ? -1 : +1)\r\n\r\n    // out of range check\r\n    if (hc + dir < -1 || hc + dir >= history.length) return\r\n\r\n    this.setState({\r\n      selected_caption_i: null,\r\n      captions: this.state.history[hc + (undo ? 0 : +1)],\r\n      historyCursor: hc + dir,\r\n    })\r\n  }\r\n\r\n  // -- caption selection\r\n\r\n  captionSelectionToggle(index: number | null) {\r\n    this.setState({\r\n      selected_caption_i:\r\n        this.state.selected_caption_i === index ? null : index\r\n    })\r\n  }\r\n\r\n  goToNextEnd() {\r\n    // TODO optimize\r\n    const\r\n      ls = this.state,\r\n      ends = ls.captions\r\n        .filter(c => ls.currentTime < c.end)\r\n        .map(c => c.end)\r\n        .sort(simpleSort)\r\n\r\n    if (ends.length)\r\n      this.VideoPlayerRef.current?.setTime(ends[0])\r\n  }\r\n\r\n  goToLastStart() {\r\n    const\r\n      ls = this.state,\r\n      starts = ls.captions\r\n        .filter(c => ls.currentTime > c.start)\r\n        .map(c => c.start)\r\n        .sort(simpleSort)\r\n\r\n    if (starts.length)\r\n      this.VideoPlayerRef.current?.setTime(starts[starts.length - 1])\r\n  }\r\n\r\n  saveFile() {\r\n    this.state.captions.sort(captionsCompare)\r\n    fileDownload(export2srt(this.state.captions), this.state.subFileName)\r\n  }\r\n\r\n  handleSeparatorStop(e: DraggableEvent, dd: DraggableData) {\r\n    this.setState({\r\n      videoHeight: this.state.videoHeight + this.state.acc,\r\n      acc: 0,\r\n    })\r\n  }\r\n  handleSeparatorDrag(e: DraggableEvent, dd: DraggableData) {\r\n    this.setState({ acc: this.state.acc + dd.deltaY })\r\n  }\r\n\r\n  render() {\r\n    const\r\n      caps = this.state.captions,\r\n      selected_ci = this.state.selected_caption_i\r\n\r\n    return (<>\r\n      <h2 className=\"page-title\">Studio</h2>\r\n      <div className=\"wrapper\">\r\n\r\n        <div className=\"video-wrapper\">\r\n          <VideoPlayer\r\n            ref={this.VideoPlayerRef}\r\n            videoUrl={this.state.videoUrl}\r\n            onTimeUpdate={this.onTimeUpdate}\r\n            onError={this.onVideoError}\r\n            height={this.state.videoHeight}\r\n            onDurationChanges={du => this.setState({ totalTime: du })}\r\n          />\r\n        </div>\r\n\r\n        <Draggable\r\n          axis=\"y\"\r\n          position={{ x: 0, y: 0 }}\r\n          onDrag={this.handleSeparatorDrag}\r\n          onStop={this.handleSeparatorStop}\r\n        >\r\n          <div className=\"separator mt-3\"></div>\r\n        </Draggable>\r\n\r\n        <CaptionView\r\n          currentTime={this.state.currentTime}\r\n          captions={caps}\r\n        />\r\n        <Timeline\r\n          className=\"my-2\"\r\n          currentTime={this.state.currentTime}\r\n          totalTime={this.state.totalTime}\r\n          onSelectNewTime={nt => this.VideoPlayerRef.current?.setTime(nt)}\r\n        />\r\n\r\n        <div className=\"d-flex justify-content-center action-button-group my-2\">\r\n          <CircleBtn\r\n            iconClassName=\"fas fa-plus\"\r\n            text=\"add caption\"\r\n            onClick={this.addCaptionUIHandler}\r\n          />\r\n          <CircleBtn\r\n            iconClassName=\"fas fa-undo\"\r\n            disabled={this.state.historyCursor === -1}\r\n            text={\"undo \" + (this.state.historyCursor + 1)}\r\n            onClick={() => this.undoRedo(true)}\r\n          />\r\n\r\n          <CircleBtn\r\n            iconClassName=\"fas fa-redo\"\r\n            text={\"redo \" + ((this.state.history.length - 1) - this.state.historyCursor)}\r\n            disabled={this.state.historyCursor >= this.state.history.length - 1}\r\n            onClick={() => this.undoRedo(false)}\r\n          />\r\n\r\n          <CircleBtn\r\n            iconClassName=\"fas fa-times\"\r\n            disabled={this.state.selected_caption_i === null}\r\n            text=\"unselect\"\r\n            onClick={() => this.setState({ selected_caption_i: null })}\r\n          />\r\n\r\n          <CircleBtn\r\n            iconClassName=\"fas fa-trash\"\r\n            disabled={this.state.selected_caption_i === null}\r\n            text=\"delete\"\r\n            onClick={this.deleteCaptionUIHandler}\r\n          />\r\n\r\n          <CircleBtn\r\n            iconClassName=\"fas fa-chevron-left\"\r\n            disabled={caps.length === 0}\r\n            text=\"last start\"\r\n            onClick={this.goToLastStart}\r\n          />\r\n          <CircleBtn\r\n            iconClassName=\"fas fa-chevron-right\"\r\n            disabled={caps.length === 0}\r\n            text=\"next end \"\r\n            onClick={this.goToNextEnd}\r\n          />\r\n\r\n        </div>\r\n\r\n        <SubtitleTimeline\r\n          className=\"my-1\"\r\n          duration={this.state.totalTime}\r\n          currentTime={this.state.currentTime}\r\n          onSelectNewTime={nt => this.VideoPlayerRef.current?.setTime(nt)}\r\n\r\n          captions={caps}\r\n          onCaptionSelected={this.captionSelectionToggle}\r\n          selectedCaption_i={selected_ci}\r\n          onCaptionChanged={this.changeCaptionUIHandler}\r\n        />\r\n\r\n        <CaptionEditor\r\n          currentTime={this.state.currentTime}\r\n          totalTime={this.state.totalTime}\r\n          caption={selected_ci === null ? null : caps[selected_ci]}\r\n          captionIndex={selected_ci === null ? -1 : selected_ci}\r\n          onCaptionChanged={this.changeCaptionUIHandler}\r\n        />\r\n\r\n      </div>\r\n\r\n      <div className=\"d-flex justify-content-center my-2 download-form\">\r\n        <input className=\"form-control\" placeholder=\"file-name.srt\" \r\n          value={this.state.subFileName} \r\n          onChange={ e => this.setState({subFileName: e.currentTarget.value})}  />\r\n        <button className=\"btn btn-danger\" onClick={this.saveFile}>\r\n          <strong> save as a file <span className=\"fas fa-file\"></span>  </strong>\r\n        </button>\r\n      </div>\r\n    </>)\r\n  }\r\n}","export default __webpack_public_path__ + \"static/media/captionDrag.0dcd63ca.gif\";","export default __webpack_public_path__ + \"static/media/TimeControll.ba1b4269.jpg\";","export default __webpack_public_path__ + \"static/media/stickTime.ee5d02c9.png\";","export default __webpack_public_path__ + \"static/media/textAlign.5bd9ab79.png\";","export default __webpack_public_path__ + \"static/media/addNewCaptionToEndOfLastOne.abf13990.jpg\";","export default __webpack_public_path__ + \"static/media/resizeVideo.342db664.png\";","import React from 'react'\r\nimport './help.sass'\r\n\r\nimport captionDrag from '../assets/captionDrag.gif'\r\nimport TCtrolImg from '../assets/TimeControll.jpg'\r\nimport StickTimeImg from '../assets/stickTime.png'\r\nimport TextAlignImg from '../assets/textAlign.png'\r\nimport addNewCap2Last from '../assets/addNewCaptionToEndOfLastOne.jpg'\r\nimport resizeVideo from '../assets/resizeVideo.png'\r\n\r\ntype State = {\r\n  shortcuts: {\r\n    keys: string[],\r\n    clue: string,\r\n  }[],\r\n  features: {\r\n    imageSrc: string,\r\n    details: string\r\n  }[],\r\n}\r\nexport default class Help extends React.Component<{}, State> {\r\n  state: State = {\r\n    shortcuts: [\r\n      {\r\n        keys: ['ctrl', 'space'],\r\n        clue: 'play/pause video player',\r\n      },\r\n      {\r\n        keys: ['ctrl', 'right/left'],\r\n        clue: 'go forward/backward in timeline [small step]',\r\n      },\r\n      {\r\n        keys: ['ctrl', 'shift', 'right/left'],\r\n        clue: 'go forward/backward in timeline [big step]',\r\n      },\r\n      {\r\n        keys: ['ctrl', '+/-'],\r\n        clue: 'zoom in/out in timeline',\r\n      },\r\n      {\r\n        keys: ['ctrl', 'shift', '+/-'],\r\n        clue: 'zoom in/out web page',\r\n      },\r\n      {\r\n        keys: ['ctrl', '6/7'],\r\n        clue: 'go to [start of last caption]/[end of next caption]',\r\n      },\r\n      {\r\n        keys: ['ctrl', 'down'],\r\n        clue: 'select current caption',\r\n      },\r\n      {\r\n        keys: ['escape'],\r\n        clue: 'unselect selected caption',\r\n      },\r\n\r\n      {\r\n        keys: ['tab', 'left/right'],\r\n        clue: 'shoot end of selected caption forward/backward',\r\n      },\r\n      {\r\n        keys: ['alt', 'left/right'],\r\n        clue: 'shoot start of selected caption forward/backward',\r\n      },\r\n      {\r\n        keys: ['ctrl', '8/9'],\r\n        clue: 'shoot start/end of selected caption to the current time',\r\n      },\r\n      {\r\n        keys: ['ctrl', 'enter'],\r\n        clue: 'create new caption',\r\n      },\r\n      {\r\n        keys: ['enter'],\r\n        clue: 'updates caption value, it works automatically when you switch between captions too',\r\n      },\r\n      {\r\n        keys: ['ctrl', 'delete'],\r\n        clue: 'delete selected caption',\r\n      },\r\n      {\r\n        keys: ['ctrl', '0'],\r\n        clue: 'toggle text direction in caption editor input [left to right]/[right to left]',\r\n      },\r\n      {\r\n        keys: ['ctrl', 'z/y'],\r\n        clue: 'undo/redo',\r\n      },\r\n      {\r\n        keys: ['ctrl', 's'],\r\n        clue: 'save subtitle',\r\n      },\r\n    ],\r\n\r\n    features: [\r\n      {\r\n        imageSrc: captionDrag,\r\n        details: `you can drag head/tail of the captions to extend/limit the timing of the caption. \r\n        dragCaption.GIF                  you can also drag center of the caption to move caption forward/backward in time.`\r\n      },\r\n  \r\n      {\r\n        imageSrc: TCtrolImg,\r\n        details: `you can change timestamp manually by double clicking on it\r\n        changes will be applied after clicking out of the timestamp`\r\n      },\r\n      {\r\n        imageSrc: StickTimeImg,\r\n        details: \"use stick time button to stick start/end of selected caption to the timeline cursor\"\r\n      },\r\n      {\r\n        imageSrc: TextAlignImg,\r\n        details: \"you can change text align according to the language you write in\"\r\n      },\r\n      {\r\n        imageSrc: addNewCap2Last,\r\n        details: \"if you add a new caption to the last 600ms of the last caption, the new caption will be inserted after last one\"\r\n      },\r\n      {\r\n        imageSrc: resizeVideo,\r\n        details: \"you can resize video by draging the thin line after video and before caption view\"\r\n      }\r\n    ]\r\n  }\r\n\r\n  render() {\r\n    return (<>\r\n      <h2 className=\"page-title\">Help</h2>\r\n      <div className=\"wrapper\">\r\n\r\n        <h3> <a href=\"#features\">#features</a> </h3>\r\n        <ul id=\"features\">\r\n          {this.state.features.map(f => <li>\r\n            <img src={f.imageSrc} className=\"d-block\" alt=\"\" />\r\n            <span> {f.details} </span>\r\n          </li>)}\r\n        </ul>\r\n\r\n        <h3> <a href=\"#shortcuts\">#shortcuts</a> </h3>\r\n        <ul id=\"shortcuts\">\r\n          {this.state.shortcuts.map(sh => (\r\n            <li className=\"shortcut d-flex justify-content-between\">\r\n              <span className=\"keys\">\r\n                {sh.keys.map((k, i) => <>\r\n                  {i !== 0 ? <span className=\"plus\">+</span> : ''}\r\n                  <code className=\"key\">{k}</code>\r\n                </>)}\r\n              </span>\r\n\r\n              <span className=\"clue\"> {sh.clue} </span>\r\n            </li>\r\n          ))}\r\n\r\n        </ul>\r\n\r\n      </div></>)\r\n  }\r\n}\r\n","import React from 'react'\r\nimport { BrowserRouter as Router, Route } from 'react-router-dom'\r\n\r\nimport { Intro, Studio, Help } from \"./pages\"\r\nimport { Toast } from \"./components/form\"\r\n\r\nimport \"./global.sass\"\r\n\r\nexport default class App extends React.Component {\r\n  render() {\r\n    return (<>\r\n      <Router basename=\"/subtitle-editor\">\r\n        <Route exact path='/' component={Intro}></Route>\r\n        <Route exact path='/studio' component={Studio}></Route>\r\n        <Route exact path='/help' component={Help}></Route>\r\n      </Router>\r\n      <Toast />\r\n    </>)\r\n  }\r\n}","import React from 'react'\r\nimport ReactDOM from 'react-dom'\r\n\r\nimport App from './App'\r\n\r\nReactDOM.render(\r\n  <React.StrictMode>\r\n    <App />\r\n  </React.StrictMode>,\r\n  document.getElementById('root')\r\n)\r\n"],"sourceRoot":""}